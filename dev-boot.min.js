var Space=function(){"use strict";const t={equals:(t,e)=>t===e};let e=y;const n={},r={owned:null,cleanups:null,context:null,owner:null};c(!1);var i=null;let s=null,o=null,h=null,a=null,l=0;function u(t){const e=s,n=i,o=0===t.length?r:{owned:null,cleanups:null,context:null,owner:n};i=o,s=null;try{return m((()=>t((()=>A(o)))),!0)}finally{s=e,i=n}}function c(e,r){r=r?Object.assign({},t,r):t;const i={value:e,observers:null,observerSlots:null,pending:n,comparator:r.equals||void 0};return[g.bind(i),t=>("function"==typeof t&&(t=t(i.pending!==n?i.pending:i.value)),p(i,t))]}function _(t,e,n){w(v(t,e,!1,1))}function d(t,n,r){e=D;const i=v(t,n,!1,1);i.user=!0,a?a.push(i):queueMicrotask((()=>w(i)))}function f(e,r,i){i=i?Object.assign({},t,i):t;const s=v(e,r,!0,0);return s.pending=n,s.observers=null,s.comparator=i.equals||void 0,w(s),g.bind(s)}function g(){if(this.sources&&this.state){const t=h;h=null,1===this.state?w(this):k(this),h=t}if(s){const t=this.observers?this.observers.length:0;s.sources?(s.sources.push(this),s.sourceSlots.push(t)):(s.sources=[this],s.sourceSlots=[t]),this.observers?(this.observers.push(s),this.observerSlots.push(s.sources.length-1)):(this.observers=[s],this.observerSlots=[s.sources.length-1])}return this.value}function p(t,e,r){return o?(t.pending===n&&o.push(t),t.pending=e,e):(t.comparator&&t.comparator(t.value,e)||(t.value=e,t.observers&&t.observers.length&&m((()=>{for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.pure?h.push(n):a.push(n),n.observers&&P(n)),n.state=1}if(h.length>1e6)throw h=[],new Error}),!1)),e)}function w(t){if(!t.fn)return;A(t);const e=i,n=s,r=l;s=i=t,function(t,e,n){let r;try{r=t.fn(e)}catch(t){E(t)}(!t.updatedAt||t.updatedAt<=n)&&(t.observers&&t.observers.length?p(t,r):t.value=r,t.updatedAt=n)}(t,t.value,r),s=n,i=e}function v(t,e,n,s=1,o){const h={fn:t,state:s,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:i,context:null,pure:n};return null===i||i!==r&&(i.owned?i.owned.push(h):i.owned=[h]),h}function m(t,n){if(h)return t();let r=!1;n||(h=[]),a?r=!0:a=[],l++;try{return t()}catch(t){E(t)}finally{!function(t){h&&(y(h),h=null);if(t)return;a.length?x((()=>{e(a),a=null})):a=null}(r)}}function x(t){if(o)return t();let e;const r=o=[];try{e=t()}finally{o=null}return m((()=>{for(let t=0;t<r.length;t+=1){const e=r[t];if(e.pending!==n){const t=e.pending;e.pending=n,p(e,t)}}}),!1),e}function b(t){if(0===t.state)return;if(2===t.state)return k(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<l);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(1===(t=e[n]).state)w(t);else if(2===t.state){const n=h;k(t,e[0]),h=n}}function y(t){for(let e=0;e<t.length;e++)b(t[e])}function k(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const r=t.sources[n];r.sources&&(1===r.state?r!==e&&b(r):2===r.state&&k(r,e))}}function A(t){let e;if(t.sources)for(;t.sources.length;){const e=t.sources.pop(),n=t.sourceSlots.pop(),r=e.observers;if(r&&r.length){const t=r.pop(),i=e.observerSlots.pop();n<r.length&&(t.sourceSlots[i]=n,r[n]=t,e.observerSlots[n]=i)}}if(t.owned){for(e=0;e<t.owned.length;e++)A(t.owned[e]);t.owned=null}if(t.cleanups){for(e=0;e<t.cleanups.length;e++)t.cleanups[e]();t.cleanups=null}t.state=0,t.context=null}function E(t){throw t}function T(t){let e;return void 0!==(e=q(i,t.id))?e:t.defaultValue}function q(t,e){return t?t.context&&void 0!==t.context[e]?t.context[e]:q(t.owner,e):void 0}function R(t){return function(e){let n;var r,s;return r=()=>n=$((()=>(i.context={[t]:e.value},function(t){const e=f(t);return f((()=>M(e())))}((()=>e.children))))),w(v(r,s,!0,void 0)),n}}function M(t){if("function"==typeof t&&!t.length)return M(t());if(Array.isArray(t)){const e=[];for(let n=0;n<t.length;n++){const r=M(t[n]);Array.isArray(r)?e.push.apply(e,r):e.push(r)}return e}return t}function $(t){let e,n=s;return s=null,e=t(),s=n,e}function D(t){let e,n=0;for(e=0;e<t.length;e++){const r=t[e];r.user?t[n++]=r:b(r)}const r=t.length;for(e=0;e<n;e++)b(t[e]);for(e=r;e<t.length;e++)b(t[e])}function S(t,e,n){const r=Array.isArray(t);let i;return s=>{let o,h=n&&n.defer;if(r){o=[];for(let e=0;e<t.length;e++)o.push(t[e]())}else o=t();if(h)return void(h=!1);const a=$((()=>e(o,i,s)));return i=o,a}}function P(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=2,n.pure?h.push(n):a.push(n),n.observers&&P(n))}}function U(t){for(let e=0;e<t.length;e++)t[e]()}function F(t,e,n={}){let r=[],s=[],o=[],h=0,a=e.length>1?[]:null;var l;return l=()=>U(o),null===i||(null===i.cleanups?i.cleanups=[l]:i.cleanups.push(l)),()=>{let i,l,_=t()||[];return $((()=>{let t,e,c,f,g,p,w,v,m,x=_.length;if(0===x)0!==h&&(U(o),o=[],r=[],s=[],h=0,a&&(a=[])),n.fallback;else if(0===h){for(s=new Array(x),l=0;l<x;l++)r[l]=_[l],s[l]=u(d);h=x}else{for(c=new Array(x),f=new Array(x),a&&(g=new Array(x)),p=0,w=Math.min(h,x);p<w&&r[p]===_[p];p++);for(w=h-1,v=x-1;w>=p&&v>=p&&r[w]===_[v];w--,v--)c[v]=s[w],f[v]=o[w],a&&(g[v]=a[w]);for(t=new Map,e=new Array(v+1),l=v;l>=p;l--)m=_[l],i=t.get(m),e[l]=void 0===i?-1:i,t.set(m,l);for(i=p;i<=w;i++)m=r[i],l=t.get(m),void 0!==l&&-1!==l?(c[l]=s[i],f[l]=o[i],a&&(g[l]=a[i]),l=e[l],t.set(m,l)):o[i]();for(l=p;l<x;l++)l in c?(s[l]=c[l],o[l]=f[l],a&&(a[l]=g[l],a[l](l))):s[l]=u(d);s=s.slice(0,h=x),r=_.slice(0)}return s}));function d(t){if(o[l]=t,a){const[t,n]=c(l);return a[l]=n,e(_[l],t)}return e(_[l])}}}function I(t,e){return $((()=>t(e)))}function L(t){return f(F((()=>t.each),t.children))}function C(t){let e=!1;const n=f((()=>t.when),void 0,{equals:(t,n)=>e?t===n:!t==!n});return f((()=>{const r=n();if(0===r||r){const n=t.children;return(e="function"==typeof n&&n.length>0)?$((()=>n(r))):n}return t.fallback}))}class B{constructor(t,e,n){this.$wrap=t,this.width=e,this.height=n,this.$canvas=document.createElement("canvas"),this.$canvas.width=e,this.$canvas.height=n,t.appendChild(this.$canvas);let r=this.$canvas.getContext("webgl2",{alpha:!0,antialias:!1});null!==r&&(this.gl=r),this.$canvas.addEventListener("webglcontextlost",(t=>{console.log("context lost"),t.preventDefault(),this.gl=void 0})),this.$canvas.addEventListener("webglcontextrestored",(()=>{console.log("restored"),null!==r&&(this.gl=r)}))}}class O{constructor(t,e,n){this.uniformData=t,this.attributeData=e,this.program=n}}function j(t,e,n){const r=N(t,t.VERTEX_SHADER,e),i=N(t,t.FRAGMENT_SHADER,n),s=t.createProgram();t.attachShader(s,r),t.attachShader(s,i),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||function(t,e,n,r){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(n,t.COMPILE_STATUS)||z(t,n),t.getShaderParameter(r,t.COMPILE_STATUS)||z(t,r),console.error("Iksir: Couldn't initialize shader"),""!==t.getProgramInfoLog(e)&&console.warn("Iksir: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}(t,s,r,i);let o=function(t,e){const n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=t.getActiveAttrib(e,i);if(0===r.name.indexOf("gl_"))continue;const s={tpe:"tpe",name:r.name,size:0,location:i};n[r.name]=s}return n}(t,s),h=function(t,e){const n={},r=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<r;i++){const r=t.getActiveUniform(e,i),s={name:r.name,location:-1,index:i};n[r.name]=s}return n}(t,s);const a=Object.keys(o);for(let e=0;e<a.length;e++)o[a[e]].location=e,t.bindAttribLocation(s,e,a[e]);t.linkProgram(s),t.deleteShader(r),t.deleteShader(i);for(let e in h)h[e],h[e].location=t.getUniformLocation(s,e);return new O(h,o,s)}function N(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}function z(t,e){const n=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),r=t.getShaderInfoLog(e),i=r.split("\n"),s={},o=i.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||s[t])&&(s[t]=!0,!0))),h=[""];o.forEach((t=>{n[t-1]=`%c${n[t-1]}%c`,h.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const a=n.join("\n");h[0]=a,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...h),console.groupEnd()}class V{constructor(t,e){this.quad=t,this.tint=e}}class X{get _flat(){return this.__flat||(this.__flat=[this,...this._children.flatMap((t=>t._flat))]),this.__flat}constructor(t=[],e=H.unit,n=H.unit){this._children=t,this.world=e,this._local=n}get quad(){return this.textint?.quad}get tint(){return this._tint}set quad(t){this.textint=new V(t,this._tint)}_tint=16777215;set tint(t){this._tint=t,this.textint&&(this.textint.tint=t)}size=Y.unit;pivot=Y.zero;scale=Y.unit;rotation=0;translate=Y.zero;get clone(){let t=new X([],this.world.clone,this._local.clone);return this._children.forEach((e=>e.clone._set_parent(t))),t.size=this.size.clone,t.pivot=this.pivot.clone,t.scale=this.scale.clone,t.rotation=this.rotation,t.translate=this.translate.clone,t.quad=this.quad,t.tint=this.tint,t._dirty_upto_parent(),t._update_world(),t}get local(){let{size:t,scale:e,rotation:n,translate:r,pivot:i}=this,s=e.mul(t);return this._local.transform_in(s,n,r,i),this._local}get x(){return this.translate.x}set x(t){this.translate.set_in(t,this.y)}get y(){return this.translate.y}set y(t){this.translate.set_in(this.x,t)}_dirty_upto_parent(){let t=this;do{t.__flat=void 0}while(t=t._parent)}_clean_children(){this._children.forEach((t=>t.parent=void 0)),this._children.splice(0),this._dirty_upto_parent()}_set_parent(t){t._children.push(this),this._parent=t,this._dirty_upto_parent()}get _next_sibling(){return this._parent._children[this._parent._children.indexOf(this)+1]}get _first_child(){return this._children[0]}_insert_before(t,e){if(t===e)return;t._remove();let n=this._children.indexOf(e);-1===n&&(n=this._children.length),this._children.splice(n,0,t),t._parent=this,t._dirty_upto_parent()}_replace_child(t,e){t._remove(),this._children.splice(this._children.indexOf(e),1,t),e._parent=void 0,t._parent=this,t._dirty_upto_parent()}_remove(){this._parent&&(this._parent._children.splice(this._parent._children.indexOf(this),1),this._parent._dirty_upto_parent(),this._parent=void 0)}_update_world(t){t?(this.world.set_in(t),this.world.mul_in(this.local)):this.world.set_in(this.local);let{world:e}=this;this._children.forEach((t=>t._update_world(e)))}}class Y{static make=(t,e)=>new Y(t,e);static get unit(){return new Y(1,1)}static get zero(){return new Y(0,0)}get vs(){return[this.x,this.y]}get mul_inverse(){return new Y(1/this.x,1/this.y)}get add_inverse(){return new Y(-this.x,-this.y)}get half(){return new Y(this.x/2,this.y/2)}get clone(){return new Y(this.x,this.y)}constructor(t,e){this.x=t,this.y=e}addy(t){return Y.make(this.x,this.y+t)}add(t){let{clone:e}=this;return e.add_in(t),e}add_in(t){this.x+=t.x,this.y+=t.y}sub(t){let{clone:e}=this;return e.sub_in(t),e}sub_in(t){this.x-=t.x,this.y-=t.y}mul(t){let{clone:e}=this;return e.mul_in(t),e}mul_in(t){this.x*=t.x,this.y*=t.y}div(t){let{clone:e}=this;return e.div_in(t),e}div_in(t){this.x/=t.x,this.y/=t.y}set_in(t,e=t){this.x=t,this.y=e}}class G{static make=(t,e,n,r)=>new G([Y.make(t,e),Y.make(t+n,e),Y.make(t+n,e+r),Y.make(t,e+r)]);static get unit(){return G.make(0,0,1,1)}get vs(){let{x:t,y:e,w:n,h:r}=this;return[t,e,n,r]}get x1(){return this.vertices[0].x}get y1(){return this.vertices[0].y}get x2(){return this.vertices[2].x}get y2(){return this.vertices[2].y}get x(){return this.x1}get y(){return this.y1}get w(){return this.x2-this.x1}get h(){return this.y2-this.y1}get vertexData(){return new Float32Array(this.vertices.flatMap((t=>t.vs)))}get indices(){return new Uint16Array([0,1,2,0,2,3])}constructor(t){this.vertices=t}transform(t){return new G(this.vertices.map((e=>t.mVec2(e))))}}class H{static get identity(){return new H(1,0,0,1,0,0)}static get unit(){return H.identity}static projection=(t,e)=>new H(1/t*2,0,0,-1/e*2,-1,1);get clone(){let{a:t,b:e,c:n,d:r,tx:i,ty:s}=this;return new H(t,e,n,r,i,s)}get inverse(){let{a:t,b:e,c:n,d:r,tx:i,ty:s}=this,o=t*r-e*n;return new H(r/o,-e/o,-n/o,t/o,(n*s-r*i)/o,-(t*s-e*i)/o)}constructor(t,e,n,r,i,s){this.a=t,this.b=e,this.c=n,this.d=r,this.tx=i,this.ty=s,this.array_t=new Float32Array([t,e,0,n,r,0,i,s,1])}rotate_in(t){let e=Math.cos(t),n=Math.sin(t),r=this.a*e-this.b*n,i=this.a*n+this.b*e,s=this.c*e-this.d*n,o=this.c*n+this.d*e,h=this.tx*e-this.ty*n,a=this.tx*n+this.ty*e;this.a=r,this.b=i,this.c=s,this.d=o,this.tx=h,this.ty=a}rotate(t){let{clone:e}=this;return e.rotate_in(t),e}scale(t,e){let n=this.a*t,r=this.b,i=this.c,s=this.d*e,o=this.tx,h=this.ty;return new H(n,r,i,s,o,h)}translate_in(t,e){this.a,this.b,this.c,this.d;let n=t+this.tx,r=e+this.ty;this.tx=n,this.ty=r}translate(t,e){let{clone:n}=this;return n.translate_in(t,e),n}scale_in(t,e){this.a=t,this.d=e}mVec2(t){let e=this.a,n=this.b,r=this.c,i=this.d,s=this.tx,o=this.ty,h=e*t.x+r*t.y+s,a=n*t.x+i*t.y+o;return Y.make(h,a)}mul_in(t){let{a:e,b:n,c:r,d:i,tx:s,ty:o}=this;this.a=t.a*e+t.b*r,this.b=t.a*n+t.b*i,this.c=t.c*e+t.d*r,this.d=t.c*n+t.d*i,this.tx=t.tx*e+t.ty*r+s,this.ty=t.tx*n+t.ty*i+o}set_in(t){let{a:e,b:n,c:r,d:i,tx:s,ty:o}=t;this.a=e,this.b=n,this.c=r,this.d=i,this.tx=s,this.ty=o}transform_in(t,e,n,r=Y.half){this.a=Math.cos(e)*t.x,this.b=Math.sin(e)*t.x,this.c=-Math.sin(e)*t.y,this.d=Math.cos(e)*t.y,this.tx=n.x-(r.x*this.a+r.y*this.c),this.ty=n.y-(r.x*this.b+r.y*this.d)}}function W(t){return[(16711680&t)>>16,(65280&t)>>8,255&t].map((t=>t/255))}class K{get gl(){return this.canvas.gl}get width(){return this.canvas.width}get height(){return this.canvas.height}constructor(t){this.canvas=t,this.projectionMatrix=H.projection(this.width,this.height)}glOnce=(t={})=>{let{gl:e}=this;if(!e)return;let{color:n}=t;e.viewport(0,0,this.width,this.height),e.clearColor(...W(n||0),1),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)};glProgram=(t,e,n)=>{let{gl:r}=this,{program:i,uniformData:s,attributeData:o}=j(r,t,e),h=r.createVertexArray();r.bindVertexArray(h);let a=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,a),r.bufferData(r.ARRAY_BUFFER,6*n*4,r.DYNAMIC_DRAW);let l=r.createBuffer();r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,l),r.bufferData(r.ELEMENT_ARRAY_BUFFER,3*n*4,r.DYNAMIC_DRAW);let u=o.aVertexPosition.location;r.enableVertexAttribArray(u),r.vertexAttribPointer(u,2,r.FLOAT,!1,28,0);let c=o.aTextureCoord.location;r.enableVertexAttribArray(c),r.vertexAttribPointer(c,2,r.FLOAT,!1,28,8);let _=o.aTint.location;return r.enableVertexAttribArray(_),r.vertexAttribPointer(_,3,r.FLOAT,!1,28,16),r.bindVertexArray(null),{program:i,uniformData:s,indexBuffer:l,attributeBuffer:a,vao:h}};glTexture(){let{gl:t}=this,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),{glTexture:e}}glUseTexture(t,e){let{gl:n}=this;n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,e.width,e.height,0,n.RGBA,n.UNSIGNED_BYTE,e)}glUse(t,e){let{gl:n}=this;n.useProgram(t),n.uniformMatrix3fv(e.projectionMatrix.location,!1,this.projectionMatrix.array_t)}glUniformUpdate(t,e){}glAttribUpdate(t,e){let{gl:n}=this;n.bindBuffer(n.ARRAY_BUFFER,t),n.bufferSubData(n.ARRAY_BUFFER,0,e,0)}glIndexUpdate(t,e){let{gl:n}=this;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e,0)}glClear(){let{gl:t}=this;t.clear(t.COLOR_BUFFER_BIT)}glDraw(t,e){let{gl:n}=this;n.bindVertexArray(e),n.drawElements(n.TRIANGLES,t,n.UNSIGNED_SHORT,0)}}class J{static make=(t,e,n,r=t.width,i=t.height)=>new J(t,G.make(e,n,r,i));get w(){return this._frame.w}get h(){return this._frame.h}get x0(){return this.frame.x}get y0(){return this.frame.y}get x1(){return this.frame.x2}get y1(){return this.y0}get x2(){return this.x1}get y2(){return this.frame.y2}get x3(){return this.x0}get y3(){return this.y2}constructor(t,e){this.texture=t,this._frame=e,this.tw=t.width,this.th=t.height,this.frame=e.transform(H.unit.scale(1/this.tw,1/this.th)),this.fsUv=new Float32Array([this.x0,this.y0,this.x1,this.y1,this.x2,this.y2,this.x3,this.y3])}}function Q(t,e){return new X}function Z(t,e,n){t[e]=null==n?void 0:n}function tt(t,e,n,r){if(void 0===n||r||(r=[]),"function"!=typeof e)return et(t,e,r,n);_((r=>et(t,e(),r,n)),r)}function et(t,e,n,r,i){for(;"function"==typeof n;)n=n();if(e===n)return n;const s=typeof e,o=void 0!==r;if(t=o&&n[0]&&n[0]._parent||t,null==e)n=it(t,n,r);else{if("function"===s)return _((()=>{let i=e();for(;"function"==typeof i;)i=i();n=et(t,i,n,r)})),()=>n;if(Array.isArray(e)){const s=[];if(nt(s,e,i))return _((()=>n=et(t,s,n,r,!0))),()=>n;if(0===s.length){if(n=it(t,n,r),o)return n}else Array.isArray(n)?0===n.length?rt(t,s):function(t,e,n){let r=n.length,i=e.length,s=r,o=0,h=0,a=e[i-1]._next_sibling,l=null;for(;o<i||h<s;)if(e[o]!==n[h]){for(;e[i-1]===n[s-1];)i--,s--;if(i===o){const e=s<r?h?n[h-1]._next_sibling:n[s-h]:a;for(;h<s;)t._insert_before(n[h++],e)}else if(s===h)for(;o<i;)l&&l.has(e[o])||e[o]._remove(),o++;else if(e[o]===n[s-1]&&n[h]===e[i-1]){const r=e[--i]._next_sibling;t._insert_before(n[h++],e[o++]._next_sibling),t._insert_before(n[--s],r),e[i]=n[s]}else{if(!l){l=new Map;let t=h;for(;t<s;)l.set(n[t],t++)}const r=l.get(e[o]);if(null!=r)if(h<r&&r<s){let a,u=o,c=1;for(;++u<i&&u<s&&null!=(a=l.get(e[u]))&&a===r+c;)c++;if(c>r-h){const i=e[o];for(;h<r;)t._insert_before(n[h++],i)}else t._replace_child(n[h++],e[o++])}else o++;else e[o++]._remove()}}else o++,h++}(t,n,s):(n&&it(t),rt(t,s));n=s}else if(e instanceof X){if(Array.isArray(n)){if(o)return n=it(t,n,r,e);it(t,n,null,e)}else null!==n&&t._first_child?t._replace_child(e,t._first_child):e._set_parent(t);n=e}}return n}function nt(t,e,n){let r=!1;for(let i=0,s=e.length;i<s;i++){let s=e[i];if(s instanceof X)t.push(s);else if(null==s||!0===s||!1===s);else if(Array.isArray(s))r=nt(t,s)||r;else if("function"==typeof s)if(n){for(;"function"==typeof s;)s=s();r=nt(t,Array.isArray(s)?s:[s])||r}else t.push(s),r=!0}return r}function rt(t,e,n){for(let n=0,r=e.length;n<r;n++)e[n]._set_parent(t)}function it(t,e,n,r){if(void 0===n)return t._clean_children()&&t._children;const i=r||[];if(e.length){let r=!1;for(let s=e.length-1;s>=0;s--){const o=e[s];if(i!==o){const e=o._parent===t;r||s?e&&o._remove():e?t._replace_child(i,o):t._insert_before(i,n)}else r=!0}}else t._insert_before(i,n);return[i]}const st=1e3/60,ot={seconds:60*st,half:30*st,thirds:20*st,lengths:15*st,sixth:10*st,five:5*st,three:50,one:1*st};function ht(t,e){if("function"==typeof e)return t[1](e);t[1]((t=>e))}function at(t,e){return t[1]((t=>(e(t),t)))}function lt(t){return Array.isArray(t)?t[0]():t()}function ut(t,e){return e.world.inverse.mVec2(t)}class ct{static make=(t,e)=>new ct(t,e);get translate(){return this.drag_move.add(this.decay)}get move(){return ut(this.drag_move,this.parent)}get drag_move(){return Y.make(...this.drag.move)}get parent(){return this.orig._parent}get drop(){return this.drag.drop}constructor(t,e){this.drag=t,this.orig=e,this.start=Y.make(...t.start),this.decay=e.translate.sub(ut(this.start,e._parent))}}class _t{static linear=t=>t;static quad_in=t=>t*t;static quad_out=t=>-t*(t-2);static quad_in_out=t=>t<.5?2*t*t:(4-2*t)*t-1;static cubit_in=t=>t*t*t;_elapsed=0;get _i(){return Math.min(1,this._elapsed/this.duration)}get i(){return this.easing(this._i)}get value(){return this.a*(1-this.i)+this.b*this.i}get has_reached(){return 1===this.i&&this._i0!==this.i}constructor(t,e,n=ot.sixth,r=_t.linear){this.a=t,this.b=e,this.duration=n,this.easing=r}new_b(t,e=this.duration){return new _t(this.value,t,e,this.easing)}update(t,e){this._i0=this.i,this._elapsed+=t}}class dt{_wheel=0;_wheel0=0;get bounds(){return this._bounds||(this._bounds=this.$canvas.getBoundingClientRect()),this._bounds}get wheel(){return this._wheel}get drag(){if(this._drag?.move)return this._drag}get click(){if(!this._drag?.move&&this._drag?.drop)return this._drag.drop}get click_down(){if(!this._drag0&&this._drag&&!this._drag?.move&&!this._drag?.drop)return this._drag.start}get hover(){if(!this._drag)return this._hover}get drag_delta(){if(this._drag?.move)return[this._drag.move[0]-this._drag.start[0],this._drag.move[1]-this._drag.start[1]]}constructor(t){this.$canvas=t}eventPosition(t){let e=function(t){return void 0!==t.clientX&&void 0!==t.clientY?[t.clientX,t.clientY]:t.targetTouches?.[0]?[t.targetTouches[0].clientX,t.targetTouches[0].clientY]:void 0}(t),{bounds:n}=this,r=320/n.width,i=180/n.height;return e&&(e[0]-=n.left,e[1]-=n.top,e[0]*=r,e[1]*=i),e}disposes=[];dispose(){this.disposes.forEach((t=>t()))}init(){let{$canvas:t,disposes:e}=this;t.addEventListener("wheel",(t=>{this._wheel=Math.sign(t.deltaY)})),t.addEventListener("mousedown",(t=>{this._drag||(this._drag1={button:t.button,start:this.eventPosition(t)})})),t.addEventListener("mousemove",(t=>{this._drag?this._drag.r_move=this.eventPosition(t):this._hover=this.eventPosition(t)}));let n=t=>{this._drag&&(this._drag.drop=this.eventPosition(t),this._drop0=this._drag)};document.addEventListener("mouseup",n),e.push((()=>document.removeEventListener("mouseup",n)));const r=()=>{this._bounds=void 0};return window.addEventListener("resize",r),document.addEventListener("scroll",r),e.push((()=>window.removeEventListener("resize",r))),e.push((()=>document.removeEventListener("scroll",r))),this}update(t,e){this._wheel0===this._wheel?this._wheel=0:this._wheel0=this._wheel,this._drag&&(this._drag.move0=this._drag.move,void 0!==this._drag.r_move&&(this._drag.move||function(t,e){let n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)>3}(this._drag.r_move,this._drag.start))&&(this._drag.move=this._drag.r_move),this._drop0?this._drop0=void 0:this._drag.drop&&(this._drag1=void 0)),this._drag0=this._drag,this._drag1!==this._drag&&(this._drag=this._drag1)}}const ft=function(t){const e=Symbol("context");return{id:e,Provider:R(e),defaultValue:t}}({}),gt=t=>{const[e,n]=c(),[r,i]=c(),[s,o]=c([16,16],{equals:!1}),[h,a]=c(new dt(t.$canvas).init(),{equals:!1}),[l,u]=c(void 0,{equals:!1});let _=[{image:e,root:r,update:s,render:l,mouse:h},{_setImage:n,_setRoot:i}];return function(t){let e,n,r=1e3/60,i=r;e=requestAnimationFrame((function s(o){let h=n?o-n:r;h=Math.min(33.333333333333336,Math.max(16.666666666666668,h)),t(h,i),i=h,n=o,e=requestAnimationFrame(s)}))}(((t,e)=>{o([t,e]),a((n=>(n.update(t,e),n))),u()})),I(ft.Provider,{value:_,get children(){return t.children}})},pt=()=>T(ft);class wt{get value(){return this.i_val.value}constructor(t,e,n,r){this.i_val=new mt(t,e,n,r),d((()=>{this.i_val.value===e&&this.i_val.new_b(e,n,t)}))}}class vt{static A=!0;static B=!1;get value(){return this.i_val.value}get resolved(){return void 0!==this.resolve&&this.i_val.resolved}get resolve(){return lt(this._resolve)}set resolve(t){ht(this._resolve,t)}constructor(t,e,n,r){this._resolve=c(),this.i_val=new mt(t,e,n,r),d((()=>{let{resolve:n,i_val:r}=this;n===vt.A?$((()=>{r.new_b(t)})):n===vt.B?$((()=>{r.new_b(e)})):r.value===e?r.new_b(t):r.value===t&&r.new_b(e)}))}}class mt{static linear=t=>t;static quad_in=t=>t*t;static quad_out=t=>-t*(t-2);static quad_in_out=t=>t<.5?2*t*t:(4-2*t)*t-1;static cubit_in=t=>t*t*t;_elapsed=c(0);get _i(){return Math.min(1,lt(this._elapsed)/this.duration)}get i(){return this.easing(this._i)}get has_reached(){return 1===this.i&&this._i0!==this.i}get resolved(){return 1===this.i}get a(){return lt(this._a)}get b(){return lt(this._b)}get value(){return this._fvalue()}constructor(t,e,n=ot.sixth,r=mt.linear){this._a=c(t),this._b=c(e),this.duration=n,this.easing=r,this._value=()=>this.a*(1-this.i)+this.b*this.i,this._fvalue=f((()=>Math.round(1e5*this._value())/1e5));let[{update:i}]=pt();d(S(i,(([t,e])=>{this._i0=this.i,ht(this._elapsed,(e=>e+t))})))}new_b(t,e=this.duration,n=this.value){this.duration=e,x((()=>{ht(this._b,t),ht(this._a,n),ht(this._elapsed,0)}))}}function xt(t,e){return 20*t+e}function bt(t){return Math.floor(t/20)}function yt(t){return t%20}const kt=[1,2,3,4,5,6,7,8,9,10,11,12,13],At=[1,2,3,4].flatMap((t=>kt.map((e=>xt(t,e))))),Et=()=>function(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}(At.slice(0));const Tt=["h","c","d","s"],qt=["A","2","3","4","5","6","7","8","9","T","J","Q","K"];function Rt(t){if(2===xt.length){let n=Tt.indexOf(t[1])+1,r=qt.indexOf(t[0])+1;if(1<=(e=n)&&e<=4&&function(t){return 1<=t&&t<=13}(r))return xt(n,r)}var e}function Mt(t){let e=[];for(let n=0;n<t.length;n+=2){let r=Rt(t.slice(n,n+2));if(!r)return;e.push(r)}return e}function $t(t){return 1===t?14:t}function Dt(t,e){return $t(yt(e))-$t(yt(t))}function St(t){let e=t.sort(Dt);const n=kt.map((t=>function(t,e){return t.filter((t=>yt(t)===e))}(e,t))).find((t=>2===t.length));if(n)return[...n,...e.filter((t=>!n.includes(t)))]}function Pt(t){let e;return e=St(t),e?[2,e]:(e=function(t){return t.sort(Dt)}(t),[1,e])}function Ut(t,e=0){return t<<20|e}function Ft(t){return(267386880&t)>>20}function It(t){return 1048575&t}function Lt(t){return 1===t?2:1}function Ct(t,e){return t<<28|e}function Bt(t){return(4026531840&t)>>28}function Ot(t){return 268435455&t}function jt(t){return Ft(Ot(t))}function Nt(t){return It(Ot(t))}const zt=[1,2];class Vt{constructor(t,e,n,r,i){this.button=t,this.stacks=e,this.small_blind=n,this.actions=r,this.left_stacks=i}get who_sb(){return Lt(this.button)}get who_bb(){return Lt(this.who_sb)}get winner(){if(1===this.who_hasnt_folded.length)return this.who_hasnt_folded}get big_blind(){return 2*this.small_blind}get bb_who(){return Lt(this.who_sb)}get bb_act_initial(){let t=this.actions.filter((t=>Bt(t)===this.bb_who));return this.current_who===this.bb_who&&1===t.length&&1===jt(t[0])}get button_has_acted(){return this.actions.filter((t=>Bt(t)===this.button)).length>=1}get post_blinds(){return!!this.actions.find((t=>1===jt(t)))}get turn_act_initial(){return!this.post_blinds&&0===this.actions.length}get pot(){return zt.map((t=>this.bets_of(t))).reduce(((t,e)=>e+t))}get last(){return this.actions[this.actions.length-1]}get current_who(){return this.turn_act_initial?this.who_sb:Lt(Bt(this.last))}get live_hands(){return zt.filter((t=>!this.actions.filter((e=>Bt(e)===t)).find((t=>5===jt(t)))))}get allowed_actions(){if(this.settled)return[];let t=this.bets_of(this.current_who)-this.bets_of(Lt(this.current_who)),e=this.left_stacks[this.current_who-1];if(0===t&&(this.bb_act_initial||this.turn_act_initial||!this.button_has_acted)){let t=this.big_blind,n=[t,3*t,5*t,e/2].filter((t=>t<e)).map((t=>Ct(this.current_who,Ut(7,t))));return[Ct(this.current_who,Ut(3)),...n,Ct(this.current_who,Ut(6,e)),Ct(this.current_who,Ut(5))]}if(t<0){let n=-t,r=2*n,i=3*n,s=5*n,o=e/2;if(e<=n)return[Ct(this.current_who,Ut(6,e)),Ct(this.current_who,Ut(5))];let h=[r,i,s].filter((t=>t<e)).map((e=>Ct(this.current_who,Ut(7,e+t))));return o>n&&h.push(Ct(this.current_who,Ut(7,o+t))),[Ct(this.current_who,Ut(4,n)),...h,Ct(this.current_who,Ut(6,e)),Ct(this.current_who,Ut(5))]}return[]}get settled(){if(this.winner)return!0;if(this.button_has_acted){if(this.bb_act_initial)return!1;{let{highest_bet:t}=this;return this.who_has_action.every((e=>this.bets_of(e)===t))}}return!1}get who_has_folded(){return this.actions.filter((t=>5===jt(t))).map(Bt)}get who_has_allin(){return this.actions.filter((t=>6===jt(t))).map(Bt)}get who_hasnt_folded(){let{who_has_folded:t}=this;return zt.filter((e=>!t.includes(e)))}get who_hasnt_allin(){let{who_has_allin:t}=this;return zt.filter((e=>!t.includes(e)))}get who_has_action(){let{who_hasnt_folded:t,who_hasnt_allin:e}=this;return zt.filter((n=>t.includes(n)&&e.includes(n)))}get no_action_left(){return this.who_has_action.length<=1}maybe_add_action(t){let e=Bt(t);if(this.allowed_actions.includes(t)){let n=this.bets_of(e)-this.bets_of(Lt(e)),r=this.left_stacks[e-1],i=Ot(t),s=0,o=Ft(i);if(4===o)s=-n;else if(6===o)s=r;else if(7===o){s=It(i)-n}return i=Ut(o,s),t=Ct(e,i),this.left_stacks[e-1]-=s,this.actions.push(t),!0}return!1}get highest_bet(){return Math.max(...zt.map((t=>this.bets_of(t))))}bets_of(t){return this.stacks[t-1]-this.left_stacks[t-1]}}Vt.make_turn=(t,e,n)=>{let r=e.slice(0);return new Vt(t,e,n,[],r)},Vt.make_blinds=(t,e,n)=>{let r=[],i=e.slice(0),s=Lt(t),o=Lt(s),h=2*n;return r.push(Ct(s,Ut(2,n))),r.push(Ct(o,Ut(1,h))),i[s-1]-=n,i[o-1]-=h,new Vt(t,e,n,r,i)};class Xt{constructor(t,e,n){this.stacks=t,this.pot=e,this.middle=n}get pov(){let t=this.show_middle?this.middle:void 0;return new Gt(this.stacks,this.pot,this.winner,t)}get show_middle(){return this.middle.hands.size>1}get winner(){return 1===this.middle.hands.size?[...this.middle.hands.keys()]:this.winner_hands.map((t=>t[0]))}get winner_hands(){let{solved_hands:t}=this;return t.filter((e=>e[1][1]===t[0][1][1]))}get solved_hands(){return[...this.middle.hands].map((([t,e])=>[t,Pt([...e,...this.middle.flop,this.middle.turn,this.middle.river])])).sort(((t,e)=>e[1][0]-t[1][0]))}get left_stacks(){let{shares:t}=this;return this.stacks.map(((e,n)=>e+t[n]))}get shares(){let t=this.winner.length,e=this.pot/t;return zt.map((t=>this.winner.includes(t)?e:0))}}class Yt{constructor(t,e,n,r,i,s,o,h,a,l){this.scheduler=t,this.on_new_action=e,this.button=n,this.middle=r,this.small_blind=i,this.stacks=s,this.preflop=o,this.new_action_now=()=>{this.current_action.winner||this.current_action.settled&&this.current_action.no_action_left?this.showdown=new Xt(this.current_action.left_stacks,this.pot,this.showdown_middle):this.river?this.showdown=new Xt(this.river.left_stacks,this.pot,this.showdown_middle):this.turn?this.river=Vt.make_turn(this.button,this.turn.left_stacks,this.small_blind):this.flop?this.turn=Vt.make_turn(this.button,this.flop.left_stacks,this.small_blind):this.flop=Vt.make_turn(this.button,this.preflop.left_stacks,this.small_blind),this.on_new_action()},this.flop=h,this.turn=a,this.river=l}get next_round_afterms(){return 3e3+(this.showdown?.show_middle?1e3+(this.river?500:this.turn?1e3:this.flop?2e3:3e3):0)}get current_who(){return this.current_action.current_who}get current_action(){return this.river??this.turn??this.flop??this.preflop}get left_stacks(){return this.showdown?.left_stacks??this.current_action.left_stacks}get settled(){return!!this.showdown||!!this.river?.settled}get winner(){return this.showdown?.winner??this.current_action.winner}get allowed_actions(){return this.current_action.allowed_actions}get povs(){return zt.map((t=>new Ht(t,{hand:this.middle.hands[t-1],flop:this.flop?this.middle.flop:void 0,turn:this.turn?this.middle.turn:void 0,river:this.river?this.middle.river:void 0},this.button,this.small_blind,this.stacks,this.preflop,this.flop,this.turn,this.river,this.showdown?.pov)))}pov_of(t){return this.povs[t-1]}get who_sb(){return Lt(this.button)}get who_bb(){return Lt(this.who_sb)}get pot(){return this.preflop.pot+(this.flop?.pot||0)+(this.turn?.pot||0)+(this.river?.pot||0)}get showdown_middle(){let{live_hands:t}=this.current_action,e=new Map;t.forEach((t=>e.set(t,this.middle.hands[t-1])));let{flop:n,turn:r,river:i}=this.middle;return{hands:e,flop:n,turn:r,river:i}}maybe_add_action(t){if(this.current_action.maybe_add_action(t))return this.current_action.settled&&this.schedule_new_action(),!0}schedule_new_action(){this.scheduler.schedule(this.new_action_now,1e3)}}Yt.make=(t,e,n,r,i)=>{let s=Et(),o=function(t,e){let n=e.pop(),r=e.pop(),i=[e.pop(),e.pop(),e.pop()];return{hands:t.map((t=>[e.pop(),e.pop()])),flop:i,turn:r,river:n}}(zt,s),h=Vt.make_blinds(n,i,r);return new Yt(t,e,n,o,r,i,h)};class Gt{constructor(t,e,n,r){this.stacks=t,this.pot=e,this.winner=n,this.middle=r}get winner_hands(){const{solved_hands:t}=this;if(t)return t.filter((e=>e[1][1]===t[0][1][1]))}get solved_hands(){const{middle:t}=this;if(t)return[...t.hands].map((([e,n])=>[e,Pt([...n,...t.flop,t.turn,t.river])])).sort(((t,e)=>e[1][0]-t[1][0]))}get left_stacks(){let{shares:t}=this;return this.stacks.map(((e,n)=>e+t[n]))}get shares(){let t=this.winner.length,e=this.pot/t;return zt.map((t=>this.winner.includes(t)?e:0))}}class Ht{constructor(t,e,n,r,i,s,o,h,a,l){this.who=t,this.middle=e,this.button=n,this.small_blind=r,this.stacks=i,this.preflop=s,this.flop=o,this.turn=h,this.river=a,this.showdown=l}get fen(){return function(t){let{who:e,middle:n,button:r,small_blind:i,stacks:s,preflop:o,flop:h,turn:a,river:l,showdown:u}=t,c=e,_=[Zt(n.hand),te(n.flop,Zt),te(n.turn,Qt),te(n.river,Qt)].join(" "),d=r,f=i,g=s.join(" "),p=re(o),w=te(h,re),v=te(a,re),m=te(l,re),x=te(u,ee);return[_,c,d,f,g,p,w,v,m,x].join(";")}(this)}get current_who(){return this.current_action.current_who}get current_action(){return this.river??this.turn??this.flop??this.preflop}get left_stacks(){return this.showdown?.left_stacks??this.current_action.left_stacks}get settled(){return!!this.showdown||!!this.river?.settled}get winner(){return this.showdown?.winner??this.current_action.winner}get allowed_actions(){return this.current_action.allowed_actions}get who_sb(){return Lt(this.button)}get who_bb(){return Lt(this.who_sb)}get pot(){return this.preflop.pot+(this.flop?.pot||0)+(this.turn?.pot||0)+(this.river?.pot||0)}}Ht.from_fen=t=>ue(t);class Wt{constructor(t,e,n,r,i,s,o){this.scheduler=t,this._on_new_action=e,this.on_new_round=n,this.on_winner=r,this.small_blind=i,this.stacks=s,this.on_new_action=()=>{this.fold_after=Date.now()+35e3,this.winner?this.on_winner():(this.round.winner&&this.schedule_new_round(),this._on_new_action())},this.new_round_now=()=>{this.turn++,this.round=Yt.make(this.scheduler,this.on_new_action,this.button,this.small_blind,this.round.left_stacks),this.fold_after=Date.now()+35e3,this.on_new_round()},this.turn=o,this.round=Yt.make(this.scheduler,this.on_new_action,this.button,this.small_blind,this.stacks),this.fold_after=Date.now()+35e3}get button(){return(this.turn+1)%2+1}get left_stacks(){return this.round.left_stacks}get winner(){let t=this.stacks.reduce(((t,e)=>t+e)),e=this.round.left_stacks.findIndex((e=>e===t))+1;if(e>0)return[e]}apply(t){if(this.round){if(this.round.maybe_add_action(t))return this.fold_after=Date.now()+35e3,!0}}schedule_new_round(){this.scheduler.schedule(this.new_round_now,this.round.next_round_afterms)}}Wt.make=(t,e,n,r,i)=>{let s=zt.map((t=>100*i));return new Wt(t,e,n,r,i,s,0)};const Kt=Mt,Jt=Rt;function Qt(t){return qt[yt(t)-1]+Tt[bt(t)-1]}function Zt(t){return 0===t.length?"-":t.map(Qt).join("")}function te(t,e){return t?e(t):"-"}function ee(t){let{stacks:e,pot:n,middle:r,winner:i}=t,s=i.join(" "),o=te(r,(t=>{let{flop:e,turn:n,river:r,hands:i}=t;return[Zt(e),Qt(n),Qt(r),[...i.keys()].map((t=>[t,Zt(i.get(t))].join(":"))).join(",")].join(" ")}));return[e.join(" "),n,s,o].join("/")}function ne(t){let e=Ot(t);return[Bt(t),Ft(e),It(e)].join(".")}function re(t){let{button:e,stacks:n,small_blind:r,actions:i,left_stacks:s}=t;return[e,n.join(" "),r,i.map(ne).join(" "),s.join(" ")].join("/")}function ie(t,e){if("-"!==t)return e(t)}const se=["1","2"];function oe(t){let e=se.indexOf(t)+1;if(e>0)return e}function he(t){let e=parseInt(t);return e??e}function ae(t){let[e,n,r,i,s]=t.split("/"),o=oe(e),h=n.split(" ").map((t=>he(t))),a=he(r),l=i?i.split(" ").map((t=>function(t){let[e,n,r]=t.split("."),i=oe(e);if(i){let t=parseInt(n);if("number"==typeof t){let e=parseInt(r);if("number"==typeof e)return Ct(i,Ut(t,e))}}}(t))):[],u=s.split(" ").map((t=>he(t)));if(o)return new Vt(o,h,a,l,u)}function le(t){let[e,n,r,i]=t.split("/"),s=e.split(" ").map((t=>he(t))),o=he(n),h=r.split(" ").map((t=>oe(t))),a=ie(i,(t=>{let[e,n,r,i]=t.split(" "),s=Kt(e),o=Jt(n),h=Jt(r),a=new Map(i.split(",").map((t=>{let[e,n]=t.split(":");return[oe(e),Kt(n)]})));return{hands:a,flop:s,turn:o,river:h}}));return new Gt(s,o,h,a)}function ue(t){let[e,n,r,i,s,o,h,a,l,u]=t.split(";"),[c,_,d,f]=e.split(" "),g={hand:Mt(c),flop:ie(_,Mt),turn:ie(d,Rt),river:ie(f,Rt)},p=oe(n),w=oe(r),v=he(i),m=s.split(" ").map((t=>he(t))),x=ae(o),b=ie(h,ae),y=ie(a,ae),k=ie(l,ae),A=ie(u,le);return new Ht(p,g,w,v,m,x,b,y,k,A)}const ce=["0","1","2","3","4","5","6","7","8","9","P",","];function _e(t){return String(t).split("").flatMap(((t,e,n)=>(n.length-e)%3==0&&0!==e?[",",t]:[t])).map((t=>ce.indexOf(t)))}const de=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","!","0","1","2","3","4","5","6","7","8","9","P",","];function fe(t){return t.split("").map((t=>de.indexOf(t)))}const ge=["","high card","one pair"];function pe(t,e){return(t-e+2)%2}const we=[[200,166],[200,20]];const ve=[[200,140],[200,50]];const me=[0,1,2,3,4,5,6];class xe{set status(t){ht(this._status,t)}get on_showdown(){return lt(this._on_showdown)}get on_action(){return lt(this._on_action)}set pov(t){ht(this._pov,t)}set fold_after(t){ht(this._fold_after,t)}get stacks(){return this._stacks()}constructor(t,e){this._status=c(""),this._on_showdown=c(void 0,{equals:!1}),this._on_action=c(void 0,{equals:!1}),this._fold_after=c(e),this._pov=c(t),this.m_current_who=f((()=>lt(this._pov).current_who)),this.m_me=f((()=>lt(this._pov).who)),this.m_who=f((()=>lt(this._pov).who)),this.who2=()=>Lt(this.m_who());let n=f((()=>lt(this._pov).allowed_actions.filter((t=>Bt(t)===this.m_who()))));this.m_allow_allin=f((()=>n().find((t=>6===jt(t))))),this.m_allow_check=f((()=>n().find((t=>3===jt(t))))),this.m_allow_call=f((()=>n().find((t=>4===jt(t))))),this.m_allow_fold=f((()=>n().find((t=>5===jt(t))))),this.m_allow_raise=f((()=>n().find((t=>7===jt(t))))),this.current_actions=f((()=>lt(this._pov).current_action.actions)),this.last_current_actions=f((()=>{let t=this.current_actions(),e=new Map;return t.forEach((t=>e.set(Bt(t),t))),[...e.values()]})),this.m_actions=f(F(this.last_current_actions,(t=>{return ke(t,...(e=this.m_me(),n=Bt(t),ve[pe(e,n)]));var e,n})));let r=f((()=>lt(this._pov).pot));this.m_pot=()=>_e(r()),this.m_hand=f(F((()=>lt(this._pov).middle.hand),((t,e)=>ye(t,131+32*e(),140)))),this.m_hand2=f(F((()=>lt(this._pov).middle.hand2),((t,e)=>ye(t,131,32*e(),60)))),this.m_flop=f(F((()=>lt(this._pov).middle.flop),((t,e)=>ye(t,10+33*e(),76))));let i=f(F((()=>{let t=lt(this._pov).middle.turn;if(t)return[t]}),((t,e)=>ye(t,112,76))));this.m_turn=()=>i()[0];let s=f(F((()=>{let t=lt(this._pov).middle.river;if(t)return[t]}),((t,e)=>ye(t,145,76))));this.m_river=()=>s()[0],this.showdown=f((()=>lt(this._pov).showdown));let o=()=>{if(!this.showdown())return lt(this._fold_after)},h=f((()=>lt(this._pov).showdown)),a=f((()=>h()?.middle)),l=f((()=>a()?.flop)),u=f((()=>a()?.turn)),_=f((()=>a()?.river)),g=f((()=>a()?.hands)),p=Ee((()=>g()?.get(this.who2())),(()=>h()?ot.seconds:void 0)),w=Ee(l,(()=>p()?!!this.m_flop().length>0?0:ot.seconds:void 0)),v=Ee(u,(()=>w()?this.m_turn()?0:ot.seconds:void 0)),m=Ee(_,(()=>v()?this.m_river()?0:ot.seconds:void 0)),x=Ee(m,(()=>ot.seconds));this.m_show_hand2=f((()=>p()?.map(((t,e)=>ye(t,131+32*e,19))))),this.m_show_flop=f((()=>w()?.map(((t,e)=>ye(t,10+33*e,76,0===this.m_flop().length))))),this.m_show_turn=f((()=>{let t=v();if(t)return ye(t,112,76,!this.m_turn())})),this.m_show_river=f((()=>{let t=m();if(t)return ye(t,145,76,this.m_river())}));let b=f(S(this.m_show_river,(()=>{let t=this.m_show_river();if(t)return[...this.m_show_flop(),this.m_show_turn(),t]}))),y=f((()=>h()?.winner_hands)),k=f((()=>new Map(zt.map((t=>[t,[this.m_hand(),this.m_show_hand2()][pe(this.m_me(),t)]])))));d(S(b,(()=>{let t=y()?.[0];if(t){let[e,[n,r]]=t;this.status=ge[n]}else this.status=void 0}))),d(S(b,(()=>{let t=b();t&&y()?.forEach((([e,[n,r]])=>{let i=k().get(e),s=r.slice(0,5);[...t,...i].forEach((t=>{s.includes(t.card)&&(s.splice(s.indexOf(t.card),1),t.elevate())}))}))}))),d((()=>{x(),ht(this._on_showdown,void 0)}));let A=Ee(f((()=>lt(this._pov).left_stacks)),(()=>h()?a()?m()?ot.seconds:30*ot.seconds:ot.seconds:ot.thirds));this.m_stacks=f((t=>A().map(((t,e)=>{return Ae(t,this.m_current_who()===e+1?o():void 0,...(n=this.m_me(),r=e+1,we[pe(n,r)]));var n,r})))),this.m_status=f((()=>{let t=lt(this._status);if(t)return be(t)}))}click_action=t=>{ht(this._on_action,t)}}const be=t=>{let e=new wt(0,1,ot.seconds),n=new vt(0,1,ot.seconds,mt.quad_in_out),r=new mt(0,1,ot.half);return{get x3(){return r.value},get x2(){return n.value},get x(){return e.value},letters:fe(t)}},ye=(t,e,n,r=!0)=>{let i=new mt(n,n,ot.seconds,mt.quad_in_out),s=new mt(0,1,ot.half);return{x:e,get y(){return i.value},card:t,reveal_frame:()=>r?s.i:1,elevate:()=>{i.new_b(n-4)},rank:()=>yt(t),suit:()=>bt(t)}},ke=(t,e,n)=>({x:e,y:n,amount:_e(Nt(t)),frame:me[jt(t)-1]}),Ae=(t,e,n,r)=>{let i=e&&new mt(Date.now(),e,e-Date.now()),s=e&&(e-Date.now())/35e3,o=f((()=>{if(i)return i.i+(1-s)}));return{turn_frame:f((()=>{if(i){let t=e-i.value;if(t<8e3){let e=ot.half+ot.thirds;return 1===Math.floor(t%e/e*2)?0:1}return 1}return 0})),i_width:o,x:n,y:r,chips:_e(t)}};function Ee(t,e){const n=c(t());let r;return d((()=>{t();let i=e();clearTimeout(r),void 0!==i?r=setTimeout((()=>{ht(n,t())}),i):ht(n,void 0)})),()=>lt(n)}class Te{constructor(t){this.config=t;let e=ue(t.fen);this.back=e,this.fold_after=t.fold_after}g_action(t){this.config.on_action?.(t)}g_showdown(){this.config.on_showdown?.()}s_set_back(t){this.back,this.back=t,this.front.pov=this.back}s_set_config(t){t.fen&&(this.s_set_back(ue(t.fen)),console.log(t.fen,ue(t.fen).left_stacks)),this.fold_after=t.fold_after,this.front.fold_after=this.fold_after}_set_front(){this.front=new xe(this.back,this.fold_after),d((()=>{let t=this.front.on_action;t&&this.g_action(t)})),d((()=>{this.front.on_showdown,this.g_showdown()}))}}const qe=Q(),Re=t=>I(Me,{get headsup(){return t.headsup}}),Me=t=>[I(Xe,{}),I(Ce,{x:244,y:105,get children(){return I(Fe,{get pot(){return t.headsup.m_pot()}})}}),I(Ce,{x:80,y:160,get children(){return I(Le,{qs:[148,32,37,14],get on_click(){return t.headsup.click_action},get action(){return t.headsup.m_allow_fold()}})}}),I(Ce,{x:20,y:160,get children(){return I(Le,{qs:[185,32,37,14],get on_click(){return t.headsup.click_action},get action(){return t.headsup.m_allow_check()}})}}),I(Ce,{x:20,y:160,get children(){return I(Le,{qs:[112,32,37,14],get on_click(){return t.headsup.click_action},get action(){return t.headsup.m_allow_call()}})}}),I(Ce,{x:80,y:140,get children(){return I(Le,{qs:[37,32,37,14],get on_click(){return t.headsup.click_action},get action(){return t.headsup.m_allow_allin()}})}}),I(Ce,{x:20,y:160,get children(){return I(Le,{qs:[112,32,37,14],get on_click(){return t.headsup.click_action},get action(){return t.headsup.m_allow_call()}})}}),I(Ce,{x:20,y:140,get children(){return I(Le,{qs:[74,32,37,14],get on_click(){return t.headsup.click_action},get action(){return t.headsup.m_allow_raise()}})}}),I(C,{get when(){return t.headsup.m_show_hand2()},get fallback(){return I(C,{get when(){return t.headsup.m_hand()},get children(){return I(L,{each:[1,2],children:(t,e)=>I(Ce,{get x(){return 131+32*e()},y:19,get children(){return I(Be,{})}})})}})},children:t=>I(L,{each:t,children:(t,e)=>I(De,{get x(){return t.x},get y(){return t.y},hand:t})})}),I(C,{get when(){return t.headsup.m_show_flop()},get fallback(){return I(L,{get each(){return t.headsup.m_flop()},children:t=>I(De,{get x(){return t.x},get y(){return t.y},hand:t})})},children:e=>I(L,{get each(){return t.headsup.m_show_flop()},children:t=>I(De,{get x(){return t.x},get y(){return t.y},hand:t})})}),I(C,{get when(){return t.headsup.m_show_turn()},get fallback(){return I(C,{get when(){return t.headsup.m_turn()},children:t=>I(De,{get x(){return t.x},get y(){return t.y},hand:t})})},children:t=>I(De,{get x(){return t.x},get y(){return t.y},hand:t})}),I(C,{get when(){return t.headsup.m_show_river()},get fallback(){return I(C,{get when(){return t.headsup.m_river()},children:t=>I(De,{get x(){return t.x},get y(){return t.y},hand:t})})},get children(){return t=>I(De,{get x(){return t.x},get y(){return t.y},hand:t})}}),I(L,{get each(){return t.headsup.m_hand()},children:t=>I(De,{get x(){return t.x},get y(){return t.y},hand:t})}),I(L,{get each(){return t.headsup.m_stacks()},children:t=>I(Ce,{get x(){return t.x},get y(){return t.y},get children(){return I(Se,{stack:t})}})}),I(L,{get each(){return t.headsup.m_actions()},children:t=>I(Ce,{get x(){return t.x},get y(){return t.y},get children(){return I(Ie,{action:t})}})}),I(C,{get when(){return t.headsup.m_status()},children:t=>I(Ce,{x:20,y:64,get children(){return I($e,{status:t})}})})],$e=t=>[I(Ve,{lum:2,get y(){return 6-6*t.status.x3},w:100,get h(){return 12*t.status.x3}}),I(C,{get when(){return 1===t.status.x3},get children(){return[I(L,{each:[.2,1,2,3,4,5,6,7,8],children:e=>I(Ve,{color:4,w:4,h:12,get x(){return 6*e+Math.sin(1*Math.PI-t.status.x2)*e*6}})}),I(Ce,{get x(){return 60*t.status.x2},y:2,get children(){return I(Ue,{get letters(){return t.status.letters}})}})]}})],De=t=>I(Ce,{get x(){return t.x},get y(){return t.y},get children(){return I(C,{get when(){return t.hand.reveal_frame()<1},get fallback(){return I(je,{get rank(){return t.hand.rank()},get suit(){return t.hand.suit()}})},get children(){return I(Oe,{get frame(){return Math.floor(5*t.hand.reveal_frame())}})}})}}),Se=t=>[I(ze,{get qs(){return[47+50*t.stack.turn_frame(),5,50,11]},x:0,y:-11}),I(ze,{qs:[50,16,50,13]}),I(Ce,{y:-2,get children(){return I(C,{get when(){return t.stack.i_width()},children:t=>[I(ze,{get size(){return Y.make(50,2)},qs:[466,33,1,1]}),I(ze,{get size(){return Y.make(50*t,2)},qs:[465,33,1,1]})]})}}),I(Ce,{x:2,y:2,get children(){return I(Pe,{get digits(){return t.stack.chips}})}})],Pe=t=>[I(L,{get each(){return t.digits},children:(e,n)=>I(Ce,{get x(){return 1+4*(8-t.digits.length+n()+1)},y:0,get children(){return I(ze,{qs:[120+8*e,48,8,7]})}})}),I(Ce,{x:40,y:0,get children(){return I(ze,{qs:[200,48,8,7]})}})],Ue=t=>I(L,{get each(){return t.letters},children:(t,e)=>I(Ce,{get x(){return 4*e()},y:0,get children(){return I(ze,{qs:[112+8*t,80,8,7]})}})}),Fe=t=>[I(ze,{qs:[443,16,49,12],y:-12}),I(ze,{qs:[0,16,50,13]}),I(Ce,{x:2,y:2,get children(){return I(Pe,{get digits(){return t.pot}})}})],Ie=t=>[I(Ye,{x:0,iy:0,y:-12,get children(){return I(ze,{get qs(){return[100+49*t.action.frame,16,49,12]}})}}),I(ze,{qs:[0,16,50,13]}),I(Ce,{x:2,y:2,get children(){return I(Pe,{get digits(){return t.action.amount}})}})],Le=t=>I(C,{get when(){return t.action},children:e=>[I(Ne,{onClick:n=>t.on_click(e),qs:[0,0,37,14]}),I(ze,{qs:[0,32,37,14]}),I(ze,{get qs(){return t.qs}})]}),Ce=t=>(()=>{const e=qe.clone;return tt(e,(()=>t.children)),_((n=>{const r=t.tint,i=t.x,s=t.y;return r!==n._v$&&Z(e,"tint",n._v$=r),i!==n._v$2&&Z(e,"x",n._v$2=i),s!==n._v$3&&Z(e,"y",n._v$3=s),n}),{_v$:void 0,_v$2:void 0,_v$3:void 0}),e})(),Be=t=>I(ze,{qs:[90,96,30,40]}),Oe=t=>I(ze,{get qs(){return[90+30*t.frame,96,30,40]}}),je=t=>{let e=t.suit%2;return[I(Ne,{get set_ref(){return t.set_ref},get onDrag(){return t.onDrag},qs:[0,48,30,40]}),I(ze,{qs:[60,96,30,40],get x(){return t.shadow||1},get y(){return t.shadow||1}}),I(ze,{qs:[0,96,30,40]}),I(ze,{get qs(){return[0+6*(t.suit-1),80+6*e,6,6]},x:22,y:2}),I(ze,{get qs(){return[0+8*(t.rank-1),64+6*e,8,6]},x:2,y:2})]},Ne=t=>{const[{mouse:e}]=pt();let n;var r;return r=()=>{t.set_ref?.(n),n.on_event=()=>{let{drag:r,click:i,click_down:s}=e();if(t.onDrag&&r&&!r.move0&&!r.drop){let e=ut(Y.make(...r.start),n);if(0===Math.floor(e.x)&&0===Math.floor(e.y)){let e=ct.make(r,n);return t.onDrag(e)}}if(t.onClick&&i){let e=ut(Y.make(...i),n);if(0===Math.floor(e.x)&&0===Math.floor(e.y))return t.onClick()}if(t.onClickDown&&s){let e=ut(Y.make(...s),n);if(0===Math.floor(e.x)&&0===Math.floor(e.y))return t.onClickDown()}}},d((()=>$(r))),(()=>{const e=qe.clone;return"function"==typeof n?n(e):n=e,_((n=>{const r=Y.make(t.qs[2],t.qs[3]),i=t.x,s=t.y;return r!==n._v$4&&Z(e,"size",n._v$4=r),i!==n._v$5&&Z(e,"x",n._v$5=i),s!==n._v$6&&Z(e,"y",n._v$6=s),n}),{_v$4:void 0,_v$5:void 0,_v$6:void 0}),e})()},ze=t=>{let[{image:e}]=pt();return(()=>{const n=qe.clone;return _((r=>{const i=J.make(e(),...t.qs),s=t.size||Y.make(t.qs[2],t.qs[3]),o=t.x,h=t.y;return i!==r._v$7&&Z(n,"quad",r._v$7=i),s!==r._v$8&&Z(n,"size",r._v$8=s),o!==r._v$9&&Z(n,"x",r._v$9=o),h!==r._v$10&&Z(n,"y",r._v$10=h),r}),{_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0}),n})()},Ve=t=>I(ze,{get qs(){return[0+2*(t.lum??2),0+2*(t.color??0),1,1]},get size(){return Y.make(t.w,t.h)},get x(){return t.x},get y(){return t.y}}),Xe=()=>I(ze,{qs:[0,332,320,180]}),Ye=t=>{let e=void 0===t.ix?t.x:t.ix,n=void 0===t.iy?t.y:t.iy,r=c(new _t(e,e,t.duration||ot.half,_t.quad_in_out),{equals:!1}),i=c(new _t(n,n,t.duration||ot.half,_t.quad_in_out),{equals:!1}),[{update:s}]=pt();return d(S(s,(([t,e])=>{at(r,(n=>n.update(t,e))),at(i,(n=>n.update(t,e)))}))),d((()=>{ht(r,(e=>e.new_b(t.x)))})),d((()=>{ht(i,(e=>e.new_b(t.y)))})),(()=>{const e=qe.clone;return tt(e,(()=>t.children)),_((t=>{const n=lt(r).value,s=lt(i).value;return n!==t._v$11&&Z(e,"x",t._v$11=n),s!==t._v$12&&Z(e,"y",t._v$12=s),t}),{_v$11:void 0,_v$12:void 0}),e})()};function Ge(t,e){return(n="63abcfeb18a9d1b1.png",new Promise((t=>{let e=new Image;e.onload=()=>t(e),e.src=n}))).then((n=>{let r=new Te(e),[i,s,o]=((t,e,n,r)=>{let i=new B(t,n,r),s=new K(i);s.glOnce(),s.glClear();let o=new X,h=256e3,{program:a,uniformData:l,indexBuffer:u,attributeBuffer:c,vao:_}=s.glProgram("#version 300 es\nin vec3 aTint;\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nout vec2 vTextureCoord;\nout vec3 vTint;\n\nvoid main() {\n  gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0, 1);\n\n  vTextureCoord = aTextureCoord;\n  vTint = aTint;\n}\n","#version 300 es\nprecision highp float;\n\nin vec3 aTint;\nin vec2 vTextureCoord;\nin vec3 vTint;\nout vec4 outColor;\n\nuniform sampler2D uSampler;\n\nvoid main() {\n  //outColor = vec4(1.0, 1.0, 0.0, 1.0);\n  vec4 color = texture(uSampler, vTextureCoord);\n  color.rgb *= vTint;\n  outColor = vec4(color.rgb * color.a, color.a);\n}\n\n",h),d=new Uint16Array(3*h),f=new Float32Array(6*h),{glTexture:g}=s.glTexture();return s.glUseTexture(g,e),[(t,e)=>{s.glClear(),s.glUse(a,l);let n=0,r=0,i=0;for(let t=0;t<o._flat.length;t++){let e=o._flat[t],{world:s,quad:h,tint:a}=e;if(!h)continue;let{vertexData:l,indices:u}=G.unit.transform(s),{texture:c,fsUv:_}=h,g=W(a);for(let t=0;t<l.length;t+=2)f[n++]=l[t],f[n++]=l[t+1],f[n++]=_[t],f[n++]=_[t+1],f[n++]=g[0],f[n++]=g[1],f[n++]=g[2];for(let t=0;t<u.length;t++)d[r++]=4*i+u[t];i++}let h=!1;for(let t=o._flat.length-1;t>=0;t--){let e=o._flat[t];h||=e.on_event?.()}s.glAttribUpdate(c,f),s.glIndexUpdate(u,d),s.glDraw(6*i,_)},o,i.$canvas]})(t,n,320,180);return function(t,e,n){let r;u((i=>{r=i,tt(e,t(),void 0,n)}))}(((t,e,n,r,i)=>{let s=()=>{const[{image:i,root:s,update:o,render:h,mouse:a},{_setImage:l,_setRoot:u}]=pt();return l(n),u(r),d(S(h,(()=>{s()._update_world(),e()}))),t._set_front(),I(Re,{get headsup(){return t.front}})};return()=>I(gt,{$canvas:i,get children(){return I(s,{})}})})(r,i,n,s,o),s),r}));var n}const He=new class{schedule(t,e){setTimeout(t,e)}};return function(t){function e(t,e){let r=t.round.pov_of(e),{fold_after:i}=t;return{fen:r.fen,fold_after:i,on_showdown:n}}function n(){console.log("here")}function r(t){o.apply(t);let n=e(o,1);s.s_set_config(n)}function i(t,e){let{fold_after:n}=t;console.log("ai ontop",t.round.allowed_actions.map(Nt));let i=function(t){let{who:e}=t;if(t.current_who===e)return t.allowed_actions[Math.floor(t.allowed_actions.length*Math.random())]}(t.round.pov_of(e));i&&setTimeout((()=>{r(i)}),500+Math.random()*(n-Date.now())/10)}let s,o=Wt.make(He,(function(){let t=e(o,1);s.s_set_config(t),i(o,2)}),(function(){let t=e(o,1);s.s_set_config(t),i(o,2)}),(function(){let t=e(o,1);s.s_set_config(t),console.log("winner",o.winner)}),10);Ge(t,{...e(o,1),on_action:function(t){r(t),i(o,2)}}).then((t=>{s=t,i(o,2)}))}}();
