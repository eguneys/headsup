var Space=function(){"use strict";const t={equals:(t,e)=>t===e};let e=y;const r={},i={owned:null,cleanups:null,context:null,owner:null};c(!1);var n=null;let s=null,o=null,a=null,h=null,l=0;function u(t){const e=s,r=n,o=0===t.length?i:{owned:null,cleanups:null,context:null,owner:r};n=o,s=null;try{return m((()=>t((()=>A(o)))),!0)}finally{s=e,n=r}}function c(e,i){i=i?Object.assign({},t,i):t;const n={value:e,observers:null,observerSlots:null,pending:r,comparator:i.equals||void 0};return[g.bind(n),t=>("function"==typeof t&&(t=t(n.pending!==r?n.pending:n.value)),p(n,t))]}function _(t,e,r){v(w(t,e,!1,1))}function d(t,r,i){e=$;const n=w(t,r,!1,1);n.user=!0,h?h.push(n):queueMicrotask((()=>v(n)))}function f(e,i,n){n=n?Object.assign({},t,n):t;const s=w(e,i,!0,0);return s.pending=r,s.observers=null,s.comparator=n.equals||void 0,v(s),g.bind(s)}function g(){if(this.sources&&this.state){const t=a;a=null,1===this.state?v(this):k(this),a=t}if(s){const t=this.observers?this.observers.length:0;s.sources?(s.sources.push(this),s.sourceSlots.push(t)):(s.sources=[this],s.sourceSlots=[t]),this.observers?(this.observers.push(s),this.observerSlots.push(s.sources.length-1)):(this.observers=[s],this.observerSlots=[s.sources.length-1])}return this.value}function p(t,e,i){return o?(t.pending===r&&o.push(t),t.pending=e,e):(t.comparator&&t.comparator(t.value,e)||(t.value=e,t.observers&&t.observers.length&&m((()=>{for(let e=0;e<t.observers.length;e+=1){const r=t.observers[e];r.state||(r.pure?a.push(r):h.push(r),r.observers&&U(r)),r.state=1}if(a.length>1e6)throw a=[],new Error}),!1)),e)}function v(t){if(!t.fn)return;A(t);const e=n,r=s,i=l;s=n=t,function(t,e,r){let i;try{i=t.fn(e)}catch(t){E(t)}(!t.updatedAt||t.updatedAt<=r)&&(t.observers&&t.observers.length?p(t,i):t.value=i,t.updatedAt=r)}(t,t.value,i),s=r,n=e}function w(t,e,r,s=1,o){const a={fn:t,state:s,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:n,context:null,pure:r};return null===n||n!==i&&(n.owned?n.owned.push(a):n.owned=[a]),a}function m(t,r){if(a)return t();let i=!1;r||(a=[]),h?i=!0:h=[],l++;try{return t()}catch(t){E(t)}finally{!function(t){a&&(y(a),a=null);if(t)return;h.length?b((()=>{e(h),h=null})):h=null}(i)}}function b(t){if(o)return t();let e;const i=o=[];try{e=t()}finally{o=null}return m((()=>{for(let t=0;t<i.length;t+=1){const e=i[t];if(e.pending!==r){const t=e.pending;e.pending=r,p(e,t)}}}),!1),e}function x(t){if(0===t.state)return;if(2===t.state)return k(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<l);)t.state&&e.push(t);for(let r=e.length-1;r>=0;r--)if(1===(t=e[r]).state)v(t);else if(2===t.state){const r=a;k(t,e[0]),a=r}}function y(t){for(let e=0;e<t.length;e++)x(t[e])}function k(t,e){t.state=0;for(let r=0;r<t.sources.length;r+=1){const i=t.sources[r];i.sources&&(1===i.state?i!==e&&x(i):2===i.state&&k(i,e))}}function A(t){let e;if(t.sources)for(;t.sources.length;){const e=t.sources.pop(),r=t.sourceSlots.pop(),i=e.observers;if(i&&i.length){const t=i.pop(),n=e.observerSlots.pop();r<i.length&&(t.sourceSlots[n]=r,i[r]=t,e.observerSlots[r]=n)}}if(t.owned){for(e=0;e<t.owned.length;e++)A(t.owned[e]);t.owned=null}if(t.cleanups){for(e=0;e<t.cleanups.length;e++)t.cleanups[e]();t.cleanups=null}t.state=0,t.context=null}function E(t){throw t}function T(t){let e;return void 0!==(e=R(n,t.id))?e:t.defaultValue}function R(t,e){return t?t.context&&void 0!==t.context[e]?t.context[e]:R(t.owner,e):void 0}function q(t){return function(e){let r;var i,s;return i=()=>r=D((()=>(n.context={[t]:e.value},function(t){const e=f(t);return f((()=>M(e())))}((()=>e.children))))),v(w(i,s,!0,void 0)),r}}function M(t){if("function"==typeof t&&!t.length)return M(t());if(Array.isArray(t)){const e=[];for(let r=0;r<t.length;r++){const i=M(t[r]);Array.isArray(i)?e.push.apply(e,i):e.push(i)}return e}return t}function D(t){let e,r=s;return s=null,e=t(),s=r,e}function $(t){let e,r=0;for(e=0;e<t.length;e++){const i=t[e];i.user?t[r++]=i:x(i)}const i=t.length;for(e=0;e<r;e++)x(t[e]);for(e=i;e<t.length;e++)x(t[e])}function S(t,e,r){const i=Array.isArray(t);let n;return s=>{let o,a=r&&r.defer;if(i){o=[];for(let e=0;e<t.length;e++)o.push(t[e]())}else o=t();if(a)return void(a=!1);const h=D((()=>e(o,n,s)));return n=o,h}}function U(t){for(let e=0;e<t.observers.length;e+=1){const r=t.observers[e];r.state||(r.state=2,r.pure?a.push(r):h.push(r),r.observers&&U(r))}}function P(t,e){return D((()=>t(e)))}function F(t){for(let e=0;e<t.length;e++)t[e]()}function L(t,e,r={}){let i=[],s=[],o=[],a=0,h=e.length>1?[]:null;var l;return l=()=>F(o),null===n||(null===n.cleanups?n.cleanups=[l]:n.cleanups.push(l)),()=>{let n,l,_=t()||[];return D((()=>{let t,e,c,f,g,p,v,w,m,b=_.length;if(0===b)0!==a&&(F(o),o=[],i=[],s=[],a=0,h&&(h=[])),r.fallback;else if(0===a){for(s=new Array(b),l=0;l<b;l++)i[l]=_[l],s[l]=u(d);a=b}else{for(c=new Array(b),f=new Array(b),h&&(g=new Array(b)),p=0,v=Math.min(a,b);p<v&&i[p]===_[p];p++);for(v=a-1,w=b-1;v>=p&&w>=p&&i[v]===_[w];v--,w--)c[w]=s[v],f[w]=o[v],h&&(g[w]=h[v]);for(t=new Map,e=new Array(w+1),l=w;l>=p;l--)m=_[l],n=t.get(m),e[l]=void 0===n?-1:n,t.set(m,l);for(n=p;n<=v;n++)m=i[n],l=t.get(m),void 0!==l&&-1!==l?(c[l]=s[n],f[l]=o[n],h&&(g[l]=h[n]),l=e[l],t.set(m,l)):o[n]();for(l=p;l<b;l++)l in c?(s[l]=c[l],o[l]=f[l],h&&(h[l]=g[l],h[l](l))):s[l]=u(d);s=s.slice(0,a=b),i=_.slice(0)}return s}));function d(t){if(o[l]=t,h){const[t,r]=c(l);return h[l]=r,e(_[l],t)}return e(_[l])}}}function C(t){return f(L((()=>t.each),t.children))}function I(t){let e=!1;const r=f((()=>t.when),void 0,{equals:(t,r)=>e?t===r:!t==!r});return f((()=>{const i=r();if(0===i||i){const r=t.children;return(e="function"==typeof r&&r.length>0)?D((()=>r(i))):r}return t.fallback}))}class B{constructor(t,e,r){this.$wrap=t,this.width=e,this.height=r,this.$canvas=document.createElement("canvas"),this.$canvas.width=e,this.$canvas.height=r,t.appendChild(this.$canvas);let i=this.$canvas.getContext("webgl2",{alpha:!0,antialias:!1});null!==i&&(this.gl=i),this.$canvas.addEventListener("webglcontextlost",(t=>{console.log("context lost"),t.preventDefault(),this.gl=void 0})),this.$canvas.addEventListener("webglcontextrestored",(()=>{console.log("restored"),null!==i&&(this.gl=i)}))}}class O{constructor(t,e,r){this.uniformData=t,this.attributeData=e,this.program=r}}function N(t,e,r){const i=j(t,t.VERTEX_SHADER,e),n=j(t,t.FRAGMENT_SHADER,r),s=t.createProgram();t.attachShader(s,i),t.attachShader(s,n),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||function(t,e,r,i){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(r,t.COMPILE_STATUS)||z(t,r),t.getShaderParameter(i,t.COMPILE_STATUS)||z(t,i),console.error("Iksir: Couldn't initialize shader"),""!==t.getProgramInfoLog(e)&&console.warn("Iksir: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}(t,s,i,n);let o=function(t,e){const r={},i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const i=t.getActiveAttrib(e,n);if(0===i.name.indexOf("gl_"))continue;const s={tpe:"tpe",name:i.name,size:0,location:n};r[i.name]=s}return r}(t,s),a=function(t,e){const r={},i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let n=0;n<i;n++){const i=t.getActiveUniform(e,n),s={name:i.name,location:-1,index:n};r[i.name]=s}return r}(t,s);const h=Object.keys(o);for(let e=0;e<h.length;e++)o[h[e]].location=e,t.bindAttribLocation(s,e,h[e]);t.linkProgram(s),t.deleteShader(i),t.deleteShader(n);for(let e in a)a[e],a[e].location=t.getUniformLocation(s,e);return new O(a,o,s)}function j(t,e,r){const i=t.createShader(e);return t.shaderSource(i,r),t.compileShader(i),i}function z(t,e){const r=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),i=t.getShaderInfoLog(e),n=i.split("\n"),s={},o=n.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||s[t])&&(s[t]=!0,!0))),a=[""];o.forEach((t=>{r[t-1]=`%c${r[t-1]}%c`,a.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const h=r.join("\n");a[0]=h,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...a),console.groupEnd()}class V{constructor(t,e){this.quad=t,this.tint=e}}class X{get _flat(){return this.__flat||(this.__flat=[this,...this._children.flatMap((t=>t._flat))]),this.__flat}constructor(t=[],e=H.unit,r=H.unit){this._children=t,this.world=e,this._local=r}get quad(){return this.textint?.quad}get tint(){return this._tint}set quad(t){this.textint=new V(t,this._tint)}_tint=16777215;set tint(t){this._tint=t,this.textint&&(this.textint.tint=t)}size=Y.unit;pivot=Y.zero;scale=Y.unit;rotation=0;translate=Y.zero;get clone(){let t=new X([],this.world.clone,this._local.clone);return this._children.forEach((e=>e.clone._set_parent(t))),t.size=this.size.clone,t.pivot=this.pivot.clone,t.scale=this.scale.clone,t.rotation=this.rotation,t.translate=this.translate.clone,t.quad=this.quad,t.tint=this.tint,t._dirty_upto_parent(),t._update_world(),t}get local(){let{size:t,scale:e,rotation:r,translate:i,pivot:n}=this,s=e.mul(t);return this._local.transform_in(s,r,i,n),this._local}get x(){return this.translate.x}set x(t){this.translate.set_in(t,this.y)}get y(){return this.translate.y}set y(t){this.translate.set_in(this.x,t)}_dirty_upto_parent(){let t=this;do{t.__flat=void 0}while(t=t._parent)}_clean_children(){this._children.forEach((t=>t.parent=void 0)),this._children.splice(0),this._dirty_upto_parent()}_set_parent(t){t._children.push(this),this._parent=t,this._dirty_upto_parent()}get _next_sibling(){return this._parent._children[this._parent._children.indexOf(this)+1]}get _first_child(){return this._children[0]}_insert_before(t,e){if(t===e)return;t._remove();let r=this._children.indexOf(e);-1===r&&(r=this._children.length),this._children.splice(r,0,t),t._parent=this,t._dirty_upto_parent()}_replace_child(t,e){t._remove(),this._children.splice(this._children.indexOf(e),1,t),e._parent=void 0,t._parent=this,t._dirty_upto_parent()}_remove(){this._parent&&(this._parent._children.splice(this._parent._children.indexOf(this),1),this._parent._dirty_upto_parent(),this._parent=void 0)}_update_world(t){t?(this.world.set_in(t),this.world.mul_in(this.local)):this.world.set_in(this.local);let{world:e}=this;this._children.forEach((t=>t._update_world(e)))}}class Y{static make=(t,e)=>new Y(t,e);static get unit(){return new Y(1,1)}static get zero(){return new Y(0,0)}get vs(){return[this.x,this.y]}get mul_inverse(){return new Y(1/this.x,1/this.y)}get add_inverse(){return new Y(-this.x,-this.y)}get half(){return new Y(this.x/2,this.y/2)}get clone(){return new Y(this.x,this.y)}constructor(t,e){this.x=t,this.y=e}addy(t){return Y.make(this.x,this.y+t)}add(t){let{clone:e}=this;return e.add_in(t),e}add_in(t){this.x+=t.x,this.y+=t.y}sub(t){let{clone:e}=this;return e.sub_in(t),e}sub_in(t){this.x-=t.x,this.y-=t.y}mul(t){let{clone:e}=this;return e.mul_in(t),e}mul_in(t){this.x*=t.x,this.y*=t.y}div(t){let{clone:e}=this;return e.div_in(t),e}div_in(t){this.x/=t.x,this.y/=t.y}set_in(t,e=t){this.x=t,this.y=e}}class G{static make=(t,e,r,i)=>new G([Y.make(t,e),Y.make(t+r,e),Y.make(t+r,e+i),Y.make(t,e+i)]);static get unit(){return G.make(0,0,1,1)}get vs(){let{x:t,y:e,w:r,h:i}=this;return[t,e,r,i]}get x1(){return this.vertices[0].x}get y1(){return this.vertices[0].y}get x2(){return this.vertices[2].x}get y2(){return this.vertices[2].y}get x(){return this.x1}get y(){return this.y1}get w(){return this.x2-this.x1}get h(){return this.y2-this.y1}get vertexData(){return new Float32Array(this.vertices.flatMap((t=>t.vs)))}get indices(){return new Uint16Array([0,1,2,0,2,3])}constructor(t){this.vertices=t}transform(t){return new G(this.vertices.map((e=>t.mVec2(e))))}}class H{static get identity(){return new H(1,0,0,1,0,0)}static get unit(){return H.identity}static projection=(t,e)=>new H(1/t*2,0,0,-1/e*2,-1,1);get clone(){let{a:t,b:e,c:r,d:i,tx:n,ty:s}=this;return new H(t,e,r,i,n,s)}get inverse(){let{a:t,b:e,c:r,d:i,tx:n,ty:s}=this,o=t*i-e*r;return new H(i/o,-e/o,-r/o,t/o,(r*s-i*n)/o,-(t*s-e*n)/o)}constructor(t,e,r,i,n,s){this.a=t,this.b=e,this.c=r,this.d=i,this.tx=n,this.ty=s,this.array_t=new Float32Array([t,e,0,r,i,0,n,s,1])}rotate_in(t){let e=Math.cos(t),r=Math.sin(t),i=this.a*e-this.b*r,n=this.a*r+this.b*e,s=this.c*e-this.d*r,o=this.c*r+this.d*e,a=this.tx*e-this.ty*r,h=this.tx*r+this.ty*e;this.a=i,this.b=n,this.c=s,this.d=o,this.tx=a,this.ty=h}rotate(t){let{clone:e}=this;return e.rotate_in(t),e}scale(t,e){let r=this.a*t,i=this.b,n=this.c,s=this.d*e,o=this.tx,a=this.ty;return new H(r,i,n,s,o,a)}translate_in(t,e){this.a,this.b,this.c,this.d;let r=t+this.tx,i=e+this.ty;this.tx=r,this.ty=i}translate(t,e){let{clone:r}=this;return r.translate_in(t,e),r}scale_in(t,e){this.a=t,this.d=e}mVec2(t){let e=this.a,r=this.b,i=this.c,n=this.d,s=this.tx,o=this.ty,a=e*t.x+i*t.y+s,h=r*t.x+n*t.y+o;return Y.make(a,h)}mul_in(t){let{a:e,b:r,c:i,d:n,tx:s,ty:o}=this;this.a=t.a*e+t.b*i,this.b=t.a*r+t.b*n,this.c=t.c*e+t.d*i,this.d=t.c*r+t.d*n,this.tx=t.tx*e+t.ty*i+s,this.ty=t.tx*r+t.ty*n+o}set_in(t){let{a:e,b:r,c:i,d:n,tx:s,ty:o}=t;this.a=e,this.b=r,this.c=i,this.d=n,this.tx=s,this.ty=o}transform_in(t,e,r,i=Y.half){this.a=Math.cos(e)*t.x,this.b=Math.sin(e)*t.x,this.c=-Math.sin(e)*t.y,this.d=Math.cos(e)*t.y,this.tx=r.x-(i.x*this.a+i.y*this.c),this.ty=r.y-(i.x*this.b+i.y*this.d)}}function W(t){return[(16711680&t)>>16,(65280&t)>>8,255&t].map((t=>t/255))}class K{get gl(){return this.canvas.gl}get width(){return this.canvas.width}get height(){return this.canvas.height}constructor(t){this.canvas=t,this.projectionMatrix=H.projection(this.width,this.height)}glOnce=(t={})=>{let{gl:e}=this;if(!e)return;let{color:r}=t;e.viewport(0,0,this.width,this.height),e.clearColor(...W(r||0),1),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)};glProgram=(t,e,r)=>{let{gl:i}=this,{program:n,uniformData:s,attributeData:o}=N(i,t,e),a=i.createVertexArray();i.bindVertexArray(a);let h=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,h),i.bufferData(i.ARRAY_BUFFER,6*r*4,i.DYNAMIC_DRAW);let l=i.createBuffer();i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,l),i.bufferData(i.ELEMENT_ARRAY_BUFFER,3*r*4,i.DYNAMIC_DRAW);let u=o.aVertexPosition.location;i.enableVertexAttribArray(u),i.vertexAttribPointer(u,2,i.FLOAT,!1,28,0);let c=o.aTextureCoord.location;i.enableVertexAttribArray(c),i.vertexAttribPointer(c,2,i.FLOAT,!1,28,8);let _=o.aTint.location;return i.enableVertexAttribArray(_),i.vertexAttribPointer(_,3,i.FLOAT,!1,28,16),i.bindVertexArray(null),{program:n,uniformData:s,indexBuffer:l,attributeBuffer:h,vao:a}};glTexture(){let{gl:t}=this,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),{glTexture:e}}glUseTexture(t,e){let{gl:r}=this;r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e.width,e.height,0,r.RGBA,r.UNSIGNED_BYTE,e)}glUse(t,e){let{gl:r}=this;r.useProgram(t),r.uniformMatrix3fv(e.projectionMatrix.location,!1,this.projectionMatrix.array_t)}glUniformUpdate(t,e){}glAttribUpdate(t,e){let{gl:r}=this;r.bindBuffer(r.ARRAY_BUFFER,t),r.bufferSubData(r.ARRAY_BUFFER,0,e,0)}glIndexUpdate(t,e){let{gl:r}=this;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,e,0)}glClear(){let{gl:t}=this;t.clear(t.COLOR_BUFFER_BIT)}glDraw(t,e){let{gl:r}=this;r.bindVertexArray(e),r.drawElements(r.TRIANGLES,t,r.UNSIGNED_SHORT,0)}}class J{static make=(t,e,r,i=t.width,n=t.height)=>new J(t,G.make(e,r,i,n));get w(){return this._frame.w}get h(){return this._frame.h}get x0(){return this.frame.x}get y0(){return this.frame.y}get x1(){return this.frame.x2}get y1(){return this.y0}get x2(){return this.x1}get y2(){return this.frame.y2}get x3(){return this.x0}get y3(){return this.y2}constructor(t,e){this.texture=t,this._frame=e,this.tw=t.width,this.th=t.height,this.frame=e.transform(H.unit.scale(1/this.tw,1/this.th)),this.fsUv=new Float32Array([this.x0,this.y0,this.x1,this.y1,this.x2,this.y2,this.x3,this.y3])}}function Q(t,e){return new X}function Z(t,e,r){t[e]=null==r?void 0:r}function tt(t,e,r,i){if(void 0===r||i||(i=[]),"function"!=typeof e)return et(t,e,i,r);_((i=>et(t,e(),i,r)),i)}function et(t,e,r,i,n){for(;"function"==typeof r;)r=r();if(e===r)return r;const s=typeof e,o=void 0!==i;if(t=o&&r[0]&&r[0]._parent||t,null==e)r=nt(t,r,i);else{if("function"===s)return _((()=>{let n=e();for(;"function"==typeof n;)n=n();r=et(t,n,r,i)})),()=>r;if(Array.isArray(e)){const s=[];if(rt(s,e,n))return _((()=>r=et(t,s,r,i,!0))),()=>r;if(0===s.length){if(r=nt(t,r,i),o)return r}else Array.isArray(r)?0===r.length?it(t,s):function(t,e,r){let i=r.length,n=e.length,s=i,o=0,a=0,h=e[n-1]._next_sibling,l=null;for(;o<n||a<s;)if(e[o]!==r[a]){for(;e[n-1]===r[s-1];)n--,s--;if(n===o){const e=s<i?a?r[a-1]._next_sibling:r[s-a]:h;for(;a<s;)t._insert_before(r[a++],e)}else if(s===a)for(;o<n;)l&&l.has(e[o])||e[o]._remove(),o++;else if(e[o]===r[s-1]&&r[a]===e[n-1]){const i=e[--n]._next_sibling;t._insert_before(r[a++],e[o++]._next_sibling),t._insert_before(r[--s],i),e[n]=r[s]}else{if(!l){l=new Map;let t=a;for(;t<s;)l.set(r[t],t++)}const i=l.get(e[o]);if(null!=i)if(a<i&&i<s){let h,u=o,c=1;for(;++u<n&&u<s&&null!=(h=l.get(e[u]))&&h===i+c;)c++;if(c>i-a){const n=e[o];for(;a<i;)t._insert_before(r[a++],n)}else t._replace_child(r[a++],e[o++])}else o++;else e[o++]._remove()}}else o++,a++}(t,r,s):(r&&nt(t),it(t,s));r=s}else if(e instanceof X){if(Array.isArray(r)){if(o)return r=nt(t,r,i,e);nt(t,r,null,e)}else null!==r&&t._first_child?t._replace_child(e,t._first_child):e._set_parent(t);r=e}}return r}function rt(t,e,r){let i=!1;for(let n=0,s=e.length;n<s;n++){let s=e[n];if(s instanceof X)t.push(s);else if(null==s||!0===s||!1===s);else if(Array.isArray(s))i=rt(t,s)||i;else if("function"==typeof s)if(r){for(;"function"==typeof s;)s=s();i=rt(t,Array.isArray(s)?s:[s])||i}else t.push(s),i=!0}return i}function it(t,e,r){for(let r=0,i=e.length;r<i;r++)e[r]._set_parent(t)}function nt(t,e,r,i){if(void 0===r)return t._clean_children()&&t._children;const n=i||[];if(e.length){let i=!1;for(let s=e.length-1;s>=0;s--){const o=e[s];if(n!==o){const e=o._parent===t;i||s?e&&o._remove():e?t._replace_child(n,o):t._insert_before(n,r)}else i=!0}}else t._insert_before(n,r);return[n]}const st=1e3/60,ot={seconds:60*st,half:30*st,thirds:20*st,lengths:15*st,sixth:10*st,five:5*st,three:50,one:1*st};function at(t,e){if("function"==typeof e)return t[1](e);t[1]((t=>e))}function ht(t,e){return t[1]((t=>(e(t),t)))}function lt(t){return Array.isArray(t)?t[0]():t()}function ut(t,e){return e.world.inverse.mVec2(t)}class ct{static make=(t,e)=>new ct(t,e);get translate(){return this.drag_move.add(this.decay)}get move(){return ut(this.drag_move,this.parent)}get drag_move(){return Y.make(...this.drag.move)}get parent(){return this.orig._parent}get drop(){return this.drag.drop}constructor(t,e){this.drag=t,this.orig=e,this.start=Y.make(...t.start),this.decay=e.translate.sub(ut(this.start,e._parent))}}class _t{static linear=t=>t;static quad_in=t=>t*t;static quad_out=t=>-t*(t-2);static quad_in_out=t=>t<.5?2*t*t:(4-2*t)*t-1;static cubit_in=t=>t*t*t;_elapsed=0;get _i(){return Math.min(1,this._elapsed/this.duration)}get i(){return this.easing(this._i)}get value(){return this.a*(1-this.i)+this.b*this.i}get has_reached(){return 1===this.i&&this._i0!==this.i}constructor(t,e,r=ot.sixth,i=_t.linear){this.a=t,this.b=e,this.duration=r,this.easing=i}new_b(t,e=this.duration){return new _t(this.value,t,e,this.easing)}update(t,e){this._i0=this.i,this._elapsed+=t}}class dt{_wheel=0;_wheel0=0;get bounds(){return this._bounds||(this._bounds=this.$canvas.getBoundingClientRect()),this._bounds}get wheel(){return this._wheel}get drag(){if(this._drag?.move)return this._drag}get click(){if(!this._drag?.move&&this._drag?.drop)return this._drag.drop}get click_down(){if(!this._drag0&&this._drag&&!this._drag?.move&&!this._drag?.drop)return this._drag.start}get hover(){if(!this._drag)return this._hover}get drag_delta(){if(this._drag?.move)return[this._drag.move[0]-this._drag.start[0],this._drag.move[1]-this._drag.start[1]]}constructor(t){this.$canvas=t}eventPosition(t){let e=function(t){return void 0!==t.clientX&&void 0!==t.clientY?[t.clientX,t.clientY]:t.targetTouches?.[0]?[t.targetTouches[0].clientX,t.targetTouches[0].clientY]:void 0}(t),{bounds:r}=this,i=320/r.width,n=180/r.height;return e&&(e[0]-=r.left,e[1]-=r.top,e[0]*=i,e[1]*=n),e}disposes=[];dispose(){this.disposes.forEach((t=>t()))}init(){let{$canvas:t,disposes:e}=this;t.addEventListener("wheel",(t=>{this._wheel=Math.sign(t.deltaY)})),t.addEventListener("mousedown",(t=>{this._drag||(this._drag1={button:t.button,start:this.eventPosition(t)})})),t.addEventListener("mousemove",(t=>{this._drag?this._drag.r_move=this.eventPosition(t):this._hover=this.eventPosition(t)}));let r=t=>{this._drag&&(this._drag.drop=this.eventPosition(t),this._drop0=this._drag)};document.addEventListener("mouseup",r),e.push((()=>document.removeEventListener("mouseup",r)));const i=()=>{this._bounds=void 0};return window.addEventListener("resize",i),document.addEventListener("scroll",i),e.push((()=>window.removeEventListener("resize",i))),e.push((()=>document.removeEventListener("scroll",i))),this}update(t,e){this._wheel0===this._wheel?this._wheel=0:this._wheel0=this._wheel,this._drag&&(this._drag.move0=this._drag.move,void 0!==this._drag.r_move&&(this._drag.move||function(t,e){let r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)>3}(this._drag.r_move,this._drag.start))&&(this._drag.move=this._drag.r_move),this._drop0?this._drop0=void 0:this._drag.drop&&(this._drag1=void 0)),this._drag0=this._drag,this._drag1!==this._drag&&(this._drag=this._drag1)}}const ft=function(t){const e=Symbol("context");return{id:e,Provider:q(e),defaultValue:t}}({}),gt=t=>{const[e,r]=c(),[i,n]=c(),[s,o]=c([16,16],{equals:!1}),[a,h]=c(new dt(t.$canvas).init(),{equals:!1}),[l,u]=c(void 0,{equals:!1});let _=[{image:e,root:i,update:s,render:l,mouse:a},{_setImage:r,_setRoot:n}];return function(t){let e,r,i=1e3/60,n=i;e=requestAnimationFrame((function s(o){let a=r?o-r:i;a=Math.min(33.333333333333336,Math.max(16.666666666666668,a)),t(a,n),n=a,r=o,e=requestAnimationFrame(s)}))}(((t,e)=>{o([t,e]),h((r=>(r.update(t,e),r))),u()})),P(ft.Provider,{value:_,get children(){return t.children}})},pt=()=>T(ft);class vt{get x(){return this._x.value}get y(){return this._y.value}set x(t){this._x.new_b(t)}set y(t){this._y.new_b(t)}set lerp(t){this._x.lerp=t,this._y.lerp=t}constructor(t,e){this._x=new mt(t),this._y=new mt(e)}_set_ref=t=>{this._ref=t};has_dropped(t){if(!this._ref)return!1;let e=ut(t,this._ref);return 0===Math.floor(e.x)&&0===Math.floor(e.y)||void 0}}class wt{static A=!0;static B=!1;get value(){return this.i_val.value}get resolved(){return void 0!==this.resolve&&this.i_val.resolved}get resolve(){return lt(this._resolve)}set resolve(t){at(this._resolve,t)}constructor(t,e,r,i){this._resolve=c(),this.i_val=new bt(t,e,r,i),d((()=>{let{resolve:r,i_val:i}=this;r===wt.A?D((()=>{i.new_b(t)})):r===wt.B?D((()=>{i.new_b(e)})):i.value===e?i.new_b(t):i.value===t&&i.new_b(e)}))}}class mt{get value(){return lt(this._i)}lerp=.5;constructor(t,e=t){this._b=c(e),this._i=c(t);let[{update:r}]=pt();d(S(r,(([t,e])=>{let r=this.lerp,i=lt(this._b);at(this._i,(t=>t*(1-r)+i*r))})))}new_b(t){at(this._b,t)}}class bt{static linear=t=>t;static quad_in=t=>t*t;static quad_out=t=>-t*(t-2);static quad_in_out=t=>t<.5?2*t*t:(4-2*t)*t-1;static cubit_in=t=>t*t*t;_elapsed=c(0);get _i(){return Math.min(1,lt(this._elapsed)/this.duration)}get i(){return this.easing(this._i)}get has_reached(){return 1===this.i&&this._i0!==this.i}get resolved(){return 1===this.i}get a(){return lt(this._a)}get b(){return lt(this._b)}get value(){return this._fvalue()}constructor(t,e,r=ot.sixth,i=bt.linear){this._a=c(t),this._b=c(e),this.duration=r,this.easing=i,this._value=()=>this.a*(1-this.i)+this.b*this.i,this._fvalue=f((()=>Math.floor(this._value())));let[{update:n}]=pt();d(S(n,(([t,e])=>{this._i0=this.i,at(this._elapsed,(e=>e+t))})))}new_b(t,e=this.duration,r=this.value){this.duration=e,b((()=>{at(this._b,t),at(this._a,r),at(this._elapsed,0)}))}}function xt(t,e){return 20*t+e}const yt=[1,2,3,4,5,6,7,8,9,10,11,12,13],kt=[1,2,3,4].flatMap((t=>yt.map((e=>xt(t,e))))),At=["h","c","d","s"],Et=["1","2","3","4","5","6","7","8","9","T","J","Q","K"];function Tt(t){if(2===xt.length){let r=At.indexOf(t[1])+1,i=Et.indexOf(t[0])+1;if(1<=(e=r)&&e<=4&&function(t){return 1<=t&&t<=13}(i))return xt(r,i)}var e}function Rt(t){let e=[];for(let r=0;r<t.length;r+=2){let i=Tt(t.slice(r,r+2));if(!i)return;e.push(i)}return e}function qt(t,e=0){return t<<20|e}function Mt(t){return(267386880&t)>>20}function Dt(t){return 1048575&t}function $t(t){return 1===t?2:1}function St(t,e){return t<<28|e}function Ut(t){return(4026531840&t)>>28}function Pt(t){return 268435455&t}function Ft(t){return Mt(Pt(t))}const Lt=[1,2];class Ct{constructor(t,e,r,i,n){this.button=t,this.stacks=e,this.small_blind=r,this.actions=i,this.left_stacks=n}get who_sb(){return $t(this.button)}get who_bb(){return $t(this.who_sb)}get winner(){if(this.settled_with_folds)return $t(Ut(this.who_has_folded[0]))}get big_blind(){return 2*this.small_blind}get bb_who(){return $t(this.who_sb)}get bb_act_initial(){return this.current_who===this.bb_who&&1===this.actions.filter((t=>Ut(t)===this.bb_who)).length}get post_blinds(){return!!this.actions.find((t=>1===Ft(t)))}get turn_act_initial(){return!this.post_blinds&&0===this.actions.length}get pot(){return Lt.map((t=>this.bets_of(t))).reduce(((t,e)=>e+t))}get last(){return this.actions[this.actions.length-1]}get current_who(){return this.turn_act_initial?this.who_sb:$t(Ut(this.last))}get allowed_actions(){let t=this.bets_of(this.current_who)-this.bets_of($t(this.current_who)),e=this.left_stacks[this.current_who-1];if(0===t&&(this.bb_act_initial||this.turn_act_initial)){let t=this.big_blind,r=[t,3*t,5*t,e/2].filter((t=>t<e)).map((t=>St(this.current_who,qt(7,t))));return[St(this.current_who,qt(3)),...r,St(this.current_who,qt(6,e)),St(this.current_who,qt(5))]}if(t<0){let r=-t,i=2*r,n=3*r,s=5*r,o=e/2;if(e<=r)return[St(this.current_who,qt(6,e)),St(this.current_who,qt(5))];let a=[i,n,s].filter((t=>t<e)).map((e=>St(this.current_who,qt(7,e+t))));return o>r&&a.push(St(this.current_who,qt(7,o+t))),[St(this.current_who,qt(4,r)),...a,St(this.current_who,qt(6,e)),St(this.current_who,qt(5))]}return[]}get settled(){let t=Lt.map((t=>this.bets_of(t))),e=t.every((e=>e===t[0]));return!!this.settled_with_allins||(!!this.settled_with_folds||!this.bb_act_initial&&e)}get who_has_folded(){return this.actions.filter((t=>5===Ft(t)))}get who_has_allin(){return this.actions.filter((t=>6===Ft(t)))}get settled_with_folds(){return 1===this.who_has_folded.length}get settled_with_allins(){return 2===this.who_has_allin.length}maybe_add_action(t){let e=Ut(t);if(this.allowed_actions.includes(t)){let r=this.bets_of(e)-this.bets_of($t(e)),i=this.left_stacks[e-1],n=Pt(t),s=0,o=Mt(n);if(4===o)s=-r;else if(6===o)s=i;else if(7===o){s=Dt(n)-r}return n=qt(o,s),t=St(e,n),this.left_stacks[e-1]-=s,this.actions.push(t),!0}return!1}bets_of(t){return this.stacks[t-1]-this.left_stacks[t-1]}}Ct.make_turn=(t,e,r)=>{let i=e.slice(0);return new Ct(t,e,r,[],i)},Ct.make_blinds=(t,e,r)=>{let i=[],n=e.slice(0),s=$t(t),o=$t(s),a=2*r;return i.push(St(s,qt(2,r))),i.push(St(o,qt(1,a))),n[s-1]-=r,n[o-1]-=a,new Ct(t,e,r,i,n)};class It{constructor(t,e){this.stacks=t,this.pot=e,this.left_stacks=t.slice(0)}get winner(){return 1}}class Bt{constructor(t,e,r,i,n,s,o,a){this.button=t,this.middle=e,this.small_blind=r,this.stacks=i,this.preflop=n,this.flop=s,this.turn=o,this.river=a}get current_who(){return this.current_action.current_who}get current_action(){return this.river??this.turn??this.flop??this.preflop}get left_stacks(){return this.showdown?.left_stacks??this.current_action.left_stacks}get settled(){return!!this.showdown||!!this.river?.settled}get winner(){return this.showdown?.winner??this.current_action.winner}get allowed_actions(){return this.current_action.allowed_actions}get povs(){return Lt.map((t=>new Ot(t,{hand:this.middle.hands[t-1],flop:this.flop?this.middle.flop:void 0,turn:this.turn?this.middle.turn:void 0,river:this.river?this.middle.river:void 0},this.button,this.small_blind,this.stacks,this.preflop,this.flop,this.turn,this.river,this.showdown)))}pov_of(t){return this.povs[t-1]}get who_sb(){return $t(this.button)}get who_bb(){return $t(this.who_sb)}get pot(){return this.preflop.pot+(this.flop?.pot||0)+(this.turn?.pot||0)+(this.river?.pot||0)}maybe_add_action(t){if(this.current_action.maybe_add_action(t))return this.current_action.winner||this.current_action.settled&&(this.current_action.settled_with_allins?this.showdown=new It(this.current_action.left_stacks,this.pot):this.river?this.showdown=new It(this.river.left_stacks,this.pot):this.turn?this.river=Ct.make_turn(this.button,this.turn.left_stacks,this.small_blind):this.flop?this.turn=Ct.make_turn(this.button,this.flop.left_stacks,this.small_blind):this.flop=Ct.make_turn(this.button,this.preflop.left_stacks,this.small_blind)),!0}}Bt.make=(t,e,r)=>{let i=kt.slice(0),n=function(t,e){let r=e.pop(),i=e.pop(),n=[e.pop(),e.pop(),e.pop()];return{hands:t.map((t=>[e.pop(),e.pop()])),flop:n,turn:i,river:r}}(Lt,i),s=Ct.make_blinds(t,r,e);return new Bt(t,n,e,r,s)};class Ot{constructor(t,e,r,i,n,s,o,a,h,l){this.who=t,this.middle=e,this.button=r,this.small_blind=i,this.stacks=n,this.preflop=s,this.flop=o,this.turn=a,this.river=h,this.showdown=l}get fen(){return function(t){let{who:e,middle:r,button:i,small_blind:n,stacks:s,preflop:o,flop:a,turn:h,river:l,showdown:u}=t,c=e,_=[zt(r.hand),Vt(r.flop,zt),Vt(r.turn,jt),Vt(r.river,jt)].join(" "),d=i,f=n,g=s.join(" "),p=Gt(o),v=Vt(a,Gt),w=Vt(h,Gt),m=Vt(l,Gt),b=Vt(u,Xt);return[_,c,d,f,g,p,v,w,m,b].join(";")}(this)}get current_who(){return this.current_action.current_who}get current_action(){return this.river??this.turn??this.flop??this.preflop}get left_stacks(){return this.showdown?.left_stacks??this.current_action.left_stacks}get settled(){return!!this.showdown||!!this.river?.settled}get winner(){return this.showdown?.winner??this.current_action.winner}get allowed_actions(){return this.current_action.allowed_actions}get who_sb(){return $t(this.button)}get who_bb(){return $t(this.who_sb)}get pot(){return this.preflop.pot+(this.flop?.pot||0)+(this.turn?.pot||0)+(this.river?.pot||0)}}Ot.from_fen=t=>te(t);class Nt{constructor(t,e,r,i,n,s,o){this.scheduler=t,this.on_new_round=e,this.small_blind=r,this.stacks=i,this.new_round_now=()=>{this.turn++,this.round=Bt.make(this.button,this.small_blind,this.round.left_stacks),this.on_new_round()},this.fold_after=n,this.turn=s,this.round=o}get button(){return this.turn%2}apply(t){if(this.round){this.round.maybe_add_action(t)&&(this.fold_after=Date.now()+35e3,this.round.winner&&this.schedule_new_round())}}schedule_new_round(){this.scheduler.schedule(this.new_round_now,5e3)}}function jt(t){return Et[function(t){return t%20}(t)-1]+At[function(t){return Math.floor(t/20)}(t)-1]}function zt(t){return 0===t.length?"-":t.map(jt).join("")}function Vt(t,e){return t?e(t):"-"}function Xt(t){let{stacks:e,pot:r}=t;return[e.join(" "),r].join("/")}function Yt(t){let e=Pt(t);return[Ut(t),Mt(e),Dt(e)].join(".")}function Gt(t){let{button:e,stacks:r,small_blind:i,actions:n,left_stacks:s}=t;return[e,r.join(" "),i,n.map(Yt).join(" "),s.join(" ")].join("/")}function Ht(t,e){if("-"!==t)return e(t)}Nt.make=(t,e,r)=>{let i=Lt.map((t=>100*r)),n=Date.now()+35e3,s=Bt.make(1,r,i);return new Nt(t,e,r,i,n,1,s)};const Wt=["1","2"];function Kt(t){let e=Wt.indexOf(t)+1;if(e>0)return e}function Jt(t){let e=parseInt(t);return e??e}function Qt(t){let[e,r,i,n,s]=t.split("/"),o=Kt(e),a=r.split(" ").map((t=>Jt(t))),h=Jt(i),l=n?n.split(" ").map((t=>function(t){let[e,r,i]=t.split("."),n=Kt(e);if(n){let t=parseInt(r);if("number"==typeof t){let e=parseInt(i);if("number"==typeof e)return St(n,qt(t,e))}}}(t))):[],u=s.split(" ").map((t=>Jt(t)));if(o)return new Ct(o,a,h,l,u)}function Zt(t){let[e,r]=t.split("/"),i=e.split(" ").map((t=>Jt(t))),n=Jt(r);return new It(i,n)}function te(t){let[e,r,i,n,s,o,a,h,l,u]=t.split(";"),[c,_,d,f]=e.split(" "),g={hand:Rt(c),flop:Ht(_,Rt),turn:Ht(d,Tt),river:Ht(f,Tt)},p=Kt(r),v=Kt(i),w=Jt(n),m=s.split(" ").map((t=>Jt(t))),b=Qt(o),x=Ht(a,Qt),y=Ht(h,Qt),k=Ht(l,Qt),A=Ht(u,Zt);return new Ot(p,g,v,w,m,b,x,y,k,A)}class ee extends vt{get hide(){if(this.i_reveal.resolve===wt.A)return this.i_reveal.value}get reveal(){if(this.i_reveal.resolve===wt.B&&!this.i_reveal.resolved)return this.i_reveal.value}get show(){if(this.i_reveal.resolve===wt.B&&this.i_reveal.resolved)return this}get ping_pong(){if(void 0===this.i_reveal.resolve)return this.i_reveal.value}get card(){return lt(this._card)}set card(t){at(this._card,t)}waiting(){this.card=void 0,this.i_reveal.resolve=void 0}constructor(t,e,r){super(t,e),this._card=c(r),this.i_reveal=new wt(0,1,ot.half+ot.thirds,bt.quad_in_out),r||(this.i_reveal.resolve=wt.A),d(S(this._card[0],((t,e)=>{e&&!t&&(this.i_reveal.resolve=wt.A),!e&&t&&(this.i_reveal.resolve=wt.B)})))}}const re=[[200,140],[200,50]],ie=[[200,166],[200,20]],ne=[0,1,2,3,4,5,6],se=["0","1","2","3","4","5","6","7","8","9","P",","];function oe(t){return String(t).split("").flatMap(((t,e,r)=>(r.length-e)%3==0&&0!==e?[",",t]:[t])).map((t=>se.indexOf(t)))}class ae{who_diff(t,e){return(t-e+2)%2}who_action_start_pos(t){return re[this.who_diff(this.me,t)]}who_stack_pos(t){return ie[this.who_diff(this.me,t)]}get fold_after(){return this.anim.fold_after}get back(){return this.anim.back}get me(){return this.who}get who(){return this.back.who}get current_who(){return this.back.current_who}get pot(){return this.back.pot}get current_stack(){return this.stacks[this.current_who-1]}constructor(t){this.anim=t,this.owner=n;let{back:e}=this,r=e.middle.hand.map((t=>new ee(0,0,t))),i=[1,2].map((t=>new ee(0,0)));this.middle=new fe(this,r,i);let s=e.allowed_actions.filter((t=>Ut(t)===this.who)),o=s.find((t=>3===Ft(t))),a=s.find((t=>4===Ft(t))),h=s.find((t=>5===Ft(t))),l=s.find((t=>7===Ft(t))),u=s.find((t=>6===Ft(t)));this.allowed_actions=new de(this,new _e(this,o),new _e(this,a),new _e(this,h),new _e(this,u),new _e(this,l));let c=e.current_action.actions.map((t=>new ue(this,t)));this.current_action=new ce(this,c),this.pot_chips=new le(this,this.pot),this.stacks=e.left_stacks.map(((t,e)=>new he(this,this.current_who===e+1?this.anim.fold_after:void 0,t,...this.who_stack_pos(e+1))))}a_wrap(t){return()=>{!function(t,e){const r=n;n=t;try{m(e,!0)}finally{n=r}}(this.owner,t)}}a_time=this.a_wrap((t=>{let{back:e,fold_after:r}=this;this.stacks.forEach((t=>{t===this.current_stack?t.fold_after=r:t.fold_after=void 0}))}));a_diff=this.a_wrap((t=>{let{back:e}=this.anim,r=e.allowed_actions.filter((t=>Ut(t)===this.who)),i=r.find((t=>3===Ft(t))),n=r.find((t=>4===Ft(t))),s=r.find((t=>5===Ft(t))),o=r.find((t=>Ft(t)>7)),a=r.find((t=>6===Ft(t)));this.allowed_actions.check.allowed=i,this.allowed_actions.call.allowed=n,this.allowed_actions.fold.allowed=s,this.allowed_actions.raise.allowed=o,this.allowed_actions.allin.allowed=a;let h=lt(this.current_action.actions),l=e.current_action.actions.map(((t,e)=>new ue(this,t))).slice(-2);l.length>1&&(l[0]=h[1]),at(this.current_action.actions,l),e.left_stacks.map(((t,e)=>this.stacks[e].stack=t))}));action(t){this.anim.g_action(t)}}class he extends vt{set stack(t){this.chips.chips=t}get turn_frame(){return this.left?this.left<5e3?Math.floor(this.left/ot.half)%2:1:0}get i_width(){let t=lt(this.i_left)?.i;return t??1*(1-this.left_ratio)+this.left_ratio*t}get left(){return lt(this.i_left)?.value}set fold_after(t){t?(at(this.i_left,new bt(t-Date.now(),0,ot.seconds*((t-Date.now())/1e3))),this.left_ratio=(t-Date.now())/35e3):at(this.i_left,void 0)}constructor(t,e,r,i,n){let s;super(i,n),this.headsup=t,this.chips=new le(t,r),this.left_ratio=(e-Date.now())/35e3,e&&(s=new bt(e-Date.now(),0,ot.seconds*((e-Date.now())/1e3))),this.i_left=c(s)}}class le{set chips(t){this._i_val.new_b(t)}constructor(t,e){this.headsup=t,this._i_val=new bt(e,e,ot.thirds,bt.quad_in_out),this.digits=c(oe(e)),d((()=>{at(this.digits,oe(Math.floor(this._i_val.value)))}))}}class ue extends vt{get frame(){return ne[this.type-1]}get type(){let t=Ft(this.aww);return t>7?7:t}constructor(t,e){super(...t.who_action_start_pos(Ut(e))),this.aww=e,this.amount=new le(t,function(t){return Dt(Pt(t))}(e))}}class ce{constructor(t,e){this.headsup=t,this.actions=c(e)}}class _e extends vt{get allowed(){return lt(this._allowed)}set allowed(t){at(this._allowed,t)}constructor(t,e){super(0,0),this.headsup=t,this.aww=e,this._allowed=c(e)}on_click=()=>{this.headsup.action(lt(this._allowed))}}class de{constructor(t,e,r,i,n,s){this.headsup=t,this.check=e,this.call=r,this.fold=i,this.allin=n,this.raise=s}}class fe{constructor(t,e,r,i,n,s){this.headsup=t,this.hand=c(e),this.hand2=c(r),this.flop=c(i),this.turn=c(n),this.river=c(s),d((()=>{let t=lt(this.flop),i=lt(this.turn),n=lt(this.river);b((()=>{r.forEach(((t,e)=>{t.lerp=.2+.08*e,t.x=131+32*e,t.y=18})),e.forEach(((t,e)=>{t.lerp=.2+.08*e,t.x=131+32*e,t.y=140})),t&&t.forEach(((t,e)=>{t.x=this.x+33*e,t.y=this.y})),i&&(i.x=this.x+132,i.y=this.y),n&&(n.x=this.x+165,n.y=this.y)}))}))}}class ge{constructor(t){this.config=t;let e=te(t.fen);this.back=e,this.fold_after=t.fold_after}g_action(t){this.config.on_action?.(t)}s_set_back(t){let e=this.back;this.back=t,this.front.a_diff(e)}s_set_config(t){t.fen&&this.s_set_back(te(t.fen));let e=this.fold_after;this.fold_after=t.fold_after,this.front.a_time(e)}_set_front(){this.front=new ae(this)}}const pe=Q(),ve=t=>P(we,{get headsup(){return t.headsup}}),we=t=>[P(Ue,{}),P(Te,{get middle(){return t.headsup.middle}}),P(Ae,{get actions(){return t.headsup.allowed_actions}}),P(ye,{get action(){return t.headsup.current_action}}),P(Re,{x:244,y:106,get children(){return P(xe,{get pot_chips(){return t.headsup.pot_chips}})}}),P(C,{get each(){return t.headsup.stacks},children:t=>P(Re,{get x(){return t.x},get y(){return t.y},get children(){return P(me,{stack:t})}})})],me=t=>[P(Se,{get qs(){return[47+50*t.stack.turn_frame,5,50,11]},x:0,y:-11}),P(Se,{qs:[50,16,50,13]}),P(Re,{y:-2,get children(){return P(I,{get when(){return t.stack.i_width},children:t=>[P(Se,{get size(){return Y.make(50,2)},qs:[466,33,1,1]}),P(Se,{get size(){return Y.make(50*t,2)},qs:[465,33,1,1]})]})}}),P(Re,{x:2,y:2,get children(){return P(be,{get digits(){return lt(t.stack.chips.digits)}})}})],be=t=>[P(C,{get each(){return t.digits},children:(e,r)=>P(Re,{get x(){return 1+4*(8-t.digits.length+r()+1)},y:0,get children(){return P(Se,{qs:[120+8*e,48,8,7]})}})}),P(Re,{x:40,y:0,get children(){return P(Se,{qs:[200,48,8,7]})}})],xe=t=>[P(Se,{qs:[443,16,49,12],y:-12}),P(Se,{qs:[0,16,50,13]}),P(Re,{x:2,y:2,get children(){return P(be,{get digits(){return lt(t.pot_chips.digits)}})}})],ye=t=>P(C,{get each(){return lt(t.action.actions)},children:t=>P(Re,{get x(){return t.x},get y(){return t.y},get children(){return P(ke,{action:t})}})}),ke=t=>[P(Pe,{x:0,iy:0,y:-12,get children(){return P(Se,{get qs(){return[100+49*t.action.frame,16,49,12]}})}}),P(Se,{qs:[0,16,50,13]}),P(Re,{x:2,y:2,get children(){return P(be,{get digits(){return lt(t.action.amount.digits)}})}})],Ae=t=>[P(Re,{x:20,y:160,get children(){return P(Ee,{get action(){return t.actions.check},qs:[185,32,37,14]})}}),P(Re,{x:20,y:160,get children(){return P(Ee,{get action(){return t.actions.call},qs:[112,32,37,14]})}}),P(Re,{x:20,y:140,get children(){return P(Ee,{get action(){return t.actions.raise},qs:[74,32,37,14]})}}),P(Re,{x:80,y:160,get children(){return P(Ee,{get action(){return t.actions.fold},qs:[148,32,37,14]})}}),P(Re,{x:80,y:140,get children(){return P(Ee,{get action(){return t.actions.allin},qs:[37,32,37,14]})}})],Ee=t=>P(I,{get when(){return t.action.allowed},children:e=>[P($e,{get onClickDown(){return t.action.on_click_down},get onClick(){return t.action.on_click},qs:[0,0,37,14]}),P(Se,{qs:[0,32,37,14]}),P(Se,{get qs(){return t.qs}})]}),Te=t=>[P(C,{get each(){return lt(t.middle.hand2)},children:e=>P(Re,{get x(){return e.x},get y(){return e.y},get children(){return P(qe,{get shadow(){return t.shadow},card:e})}})}),P(C,{get each(){return lt(t.middle.hand)},children:e=>P(Re,{get x(){return e.x},get y(){return e.y},get children(){return P(qe,{get shadow(){return t.shadow},card:e})}})})],Re=t=>(()=>{const e=pe.clone;return tt(e,(()=>t.children)),_((r=>{const i=t.tint,n=t.x,s=t.y;return i!==r._v$&&Z(e,"tint",r._v$=i),n!==r._v$2&&Z(e,"x",r._v$2=n),s!==r._v$3&&Z(e,"y",r._v$3=s),r}),{_v$:void 0,_v$2:void 0,_v$3:void 0}),e})(),qe=t=>[P(I,{get when(){return t.card.ping_pong??t.card.reveal??t.card.hide},children:t=>P(Me,{get frame(){return Math.floor(5*(1===t?.9:t))}})}),P(I,{get when(){return t.card.show},children:e=>P(De,{get shadow(){return t.shadow},get set_ref(){return e._set_ref},card:e,get onDrag(){return t.onDrag}})})],Me=t=>P(Se,{get qs(){return[90+30*t.frame,96,30,40]}}),De=t=>[P($e,{get set_ref(){return t.set_ref},get onDrag(){return t.onDrag},qs:[0,48,30,40]}),P(Se,{qs:[60,96,30,40],get x(){return t.shadow||1},get y(){return t.shadow||1}}),P(Se,{qs:[0,96,30,40]}),P(Se,{qs:[0,80,6,6],x:22,y:2}),P(Se,{qs:[0,64,8,6],x:2,y:2})],$e=t=>{const[{mouse:e}]=pt();let r;var i;return i=()=>{t.set_ref?.(r),r.on_event=()=>{let{drag:i,click:n,click_down:s}=e();if(t.onDrag&&i&&!i.move0&&!i.drop){let e=ut(Y.make(...i.start),r);if(0===Math.floor(e.x)&&0===Math.floor(e.y)){let e=ct.make(i,r);return t.onDrag(e)}}if(t.onClick&&n){let e=ut(Y.make(...n),r);if(0===Math.floor(e.x)&&0===Math.floor(e.y))return t.onClick()}if(t.onClickDown&&s){let e=ut(Y.make(...s),r);if(0===Math.floor(e.x)&&0===Math.floor(e.y))return t.onClickDown()}}},d((()=>D(i))),(()=>{const e=pe.clone;return"function"==typeof r?r(e):r=e,_((r=>{const i=Y.make(t.qs[2],t.qs[3]),n=t.x,s=t.y;return i!==r._v$4&&Z(e,"size",r._v$4=i),n!==r._v$5&&Z(e,"x",r._v$5=n),s!==r._v$6&&Z(e,"y",r._v$6=s),r}),{_v$4:void 0,_v$5:void 0,_v$6:void 0}),e})()},Se=t=>{let[{image:e}]=pt();return(()=>{const r=pe.clone;return _((i=>{const n=J.make(e(),...t.qs),s=t.size||Y.make(t.qs[2],t.qs[3]),o=t.x,a=t.y;return n!==i._v$7&&Z(r,"quad",i._v$7=n),s!==i._v$8&&Z(r,"size",i._v$8=s),o!==i._v$9&&Z(r,"x",i._v$9=o),a!==i._v$10&&Z(r,"y",i._v$10=a),i}),{_v$7:void 0,_v$8:void 0,_v$9:void 0,_v$10:void 0}),r})()},Ue=()=>P(Se,{qs:[0,332,320,180]}),Pe=t=>{let e=void 0===t.ix?t.x:t.ix,r=void 0===t.iy?t.y:t.iy,i=c(new _t(e,e,t.duration||ot.half,_t.quad_in_out),{equals:!1}),n=c(new _t(r,r,t.duration||ot.half,_t.quad_in_out),{equals:!1}),[{update:s}]=pt();return d(S(s,(([t,e])=>{ht(i,(r=>r.update(t,e))),ht(n,(r=>r.update(t,e)))}))),d((()=>{at(i,(e=>e.new_b(t.x)))})),d((()=>{at(n,(e=>e.new_b(t.y)))})),(()=>{const e=pe.clone;return tt(e,(()=>t.children)),_((t=>{const r=lt(i).value,s=lt(n).value;return r!==t._v$11&&Z(e,"x",t._v$11=r),s!==t._v$12&&Z(e,"y",t._v$12=s),t}),{_v$11:void 0,_v$12:void 0}),e})()};function Fe(t,e){return(r="60e42779926fcece.png",new Promise((t=>{let e=new Image;e.onload=()=>t(e),e.src=r}))).then((r=>{let i=new ge(e),[n,s,o]=((t,e,r,i)=>{let n=new B(t,r,i),s=new K(n);s.glOnce(),s.glClear();let o=new X,a=256e3,{program:h,uniformData:l,indexBuffer:u,attributeBuffer:c,vao:_}=s.glProgram("#version 300 es\nin vec3 aTint;\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nout vec2 vTextureCoord;\nout vec3 vTint;\n\nvoid main() {\n  gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0, 1);\n\n  vTextureCoord = aTextureCoord;\n  vTint = aTint;\n}\n","#version 300 es\nprecision highp float;\n\nin vec3 aTint;\nin vec2 vTextureCoord;\nin vec3 vTint;\nout vec4 outColor;\n\nuniform sampler2D uSampler;\n\nvoid main() {\n  //outColor = vec4(1.0, 1.0, 0.0, 1.0);\n  vec4 color = texture(uSampler, vTextureCoord);\n  color.rgb *= vTint;\n  outColor = vec4(color.rgb * color.a, color.a);\n}\n\n",a),d=new Uint16Array(3*a),f=new Float32Array(6*a),{glTexture:g}=s.glTexture();return s.glUseTexture(g,e),[(t,e)=>{s.glClear(),s.glUse(h,l);let r=0,i=0,n=0;for(let t=0;t<o._flat.length;t++){let e=o._flat[t],{world:s,quad:a,tint:h}=e;if(!a)continue;let{vertexData:l,indices:u}=G.unit.transform(s),{texture:c,fsUv:_}=a,g=W(h);for(let t=0;t<l.length;t+=2)f[r++]=l[t],f[r++]=l[t+1],f[r++]=_[t],f[r++]=_[t+1],f[r++]=g[0],f[r++]=g[1],f[r++]=g[2];for(let t=0;t<u.length;t++)d[i++]=4*n+u[t];n++}let a=!1;for(let t=o._flat.length-1;t>=0;t--){let e=o._flat[t];a||=e.on_event?.()}s.glAttribUpdate(c,f),s.glIndexUpdate(u,d),s.glDraw(6*n,_)},o,n.$canvas]})(t,r,320,180);return function(t,e,r){let i;u((n=>{i=n,tt(e,t(),void 0,r)}))}(((t,e,r,i,n)=>{let s=()=>{const[{image:n,root:s,update:o,render:a,mouse:h},{_setImage:l,_setRoot:u}]=pt();return l(r),u(i),d(S(a,(()=>{s()._update_world(),e()}))),t._set_front(),P(ve,{get headsup(){return t.front}})};return()=>P(gt,{$canvas:n,get children(){return P(s,{})}})})(i,n,r,s,o),s),i}));var r}const Le=new class{schedule(t,e){setTimeout(t,e)}};return function(t){function e(t,e){let r=t.round.pov_of(e),{fold_after:i}=t;return{fen:r.fen,fold_after:i}}function r(t){s.apply(t);let r=e(s,1);n.s_set_config(r)}function i(t,e){let{fold_after:i}=t,n=function(t){let{who:e}=t;if(t.current_who===e)return t.allowed_actions[Math.floor(t.allowed_actions.length*Math.random())]}(t.round.pov_of(e));n&&setTimeout((()=>{r(n)}),500+Math.random()*(i-Date.now())/10)}let n,s=Nt.make(Le,(function(){console.log("here"),console.log(s)}),10);Fe(t,{...e(s,1),on_action:function(t){r(t),i(s,2)}}).then((t=>{n=t,i(s,2)}))}}();
